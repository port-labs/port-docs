# Open Jira Issue with automatic label

## Overview
This guide shows an example of creating a Jira issue with a label that links the issue to a concerned service.

## Use cases
* Categorize tasks, issues and bugs by services directly from Port
* Add service metadata to issues from Port

## Prerequisites

* [Jira API token](https://support.atlassian.com/atlassian-account/docs/manage-api-tokens-for-your-atlassian-account/) with permissions to create new issues
* [Port's GitHub app](https://github.com/apps/getport-io) needs to be installed.
* You have finished the [onboarding process](/quickstart) and created a `Service` blueprint from the onboarding steps.

## Steps

1. Create the following GitHub action secrets

    * JIRA_API_TOKEN - [Jira API token](https://support.atlassian.com/atlassian-account/docs/manage-api-tokens-for-your-atlassian-account) generated by the user
    * JIRA_BASE_URL - The URL of your Jira organization
    * JIRA_USER_EMAIL - The email of the Jira user that owns the Jira API token
    * PORT_CLIENT_ID - Your port [client id]([How to get the credentials](https://docs.getport.io/build-your-software-catalog/sync-data-to-catalog/api/#find-your-port-credentials))
    * PORT_CLIENT_SECRET - Your port [client secret]([How to get the credentials](https://docs.getport.io/build-your-software-catalog/sync-data-to-catalog/api/#find-your-port-credentials))

2. Optional - Install Port's Jira integration [learn more](https://docs.getport.io/build-your-software-catalog/sync-data-to-catalog/project-management/jira#installation)

:::tip Blueprint

This step is not required for this example, but it will create all the blueprint boilerplate for you, and also update the catalog in real time with the new issue created.

:::

3. Creating the action in Port

:::tip Action usage

This action is on the `Service` blueprint.

:::

<details>
<summary><b>Open Jira Issue with automatic label (Click to expand)</b></summary>

```json showLineNumbers
{
  "identifier": "open_jira_issue_with_automatic_label",
  "title": "Open Jira Issue with automatic label",
  "icon": "Jira",
  "userInputs": {
    "properties": {
      "title": {
        "title": "Title",
        "description": "Title of the Jira issue",
        "icon": "Jira",
        "type": "string"
      },
      "type": {
        "title": "Type",
        "description": "Issue type",
        "icon": "Jira",
        "type": "string",
        "default": "Task",
        "enum": [
          "Task",
          "Story",
          "Bug",
          "Epic"
        ],
        "enumColors": {
          "Task": "blue",
          "Story": "green",
          "Bug": "red",
          "Epic": "pink"
        }
      }
    },
    "required": [
      "title",
      "type"
    ],
    "order": [
      "title",
      "type"
    ]
  },
  "invocationMethod": {
    "type": "GITHUB",
    "org": "<Enter GitHub organization>",
    "repo": "<Enter GitHub repository>",
    "workflow": "open-jira-issue-with-automatic-label.yml",
    "omitUserInputs": false,
    "omitPayload": false,
    "reportWorkflowStatus": true
  },
  "trigger": "DAY-2",
  "description": "Creates a Jira issue with a label to the concerned service.",
  "requiredApproval": false
}
```

</details>

4. Create a workflow file under `.github/workflows/open-jira-issue-with-automatic-label.yml` using the workflow:

<details>
<summary><b>Open Jira Issue with automatic label workflow (Click to expand)</b></summary>

```yaml showLineNumbers
name: Open Jira Issue with automatic label
on:
  workflow_dispatch:
    inputs:
      title:
        required: true
        type: string
      type:
        required: true
        type: string
      project:
        required: true
        type: string
      port_payload:
        required: true
        description:
          Port's payload, including details for who triggered the action and
          general context (blueprint, run id, etc...)
        type: string
jobs:
  create-entity-in-port-and-update-run:
    runs-on: ubuntu-latest
    steps:
      - name: Login
        uses: atlassian/gajira-login@v3
        env:
          JIRA_BASE_URL: ${{ secrets.JIRA_BASE_URL }}
          JIRA_USER_EMAIL: ${{ secrets.JIRA_USER_EMAIL }}
          JIRA_API_TOKEN: ${{ secrets.JIRA_API_TOKEN }}

      - name: Inform starting of jira issue creation
        uses: port-labs/port-github-action@v1
        with:
          clientId: ${{ secrets.PORT_CLIENT_ID }}
          clientSecret: ${{ secrets.PORT_CLIENT_SECRET }}
          operation: PATCH_RUN
          runId: ${{ fromJson(inputs.port_payload).context.runId }}
          logMessage: |
            Creating a new Jira issue with automatic label.. ⛴️

      - name: Create Jira issue
        id: create
        uses: atlassian/gajira-create@v3
        with:
          project: ${{ github.event.inputs.project }}
          issuetype: ${{ github.event.inputs.type }}
          summary: ${{ github.event.inputs.title }}
          fields: '{"labels": ["port-${{ fromJson(inputs.port_payload).context.entity }}"]}'

      - name: Inform creation of Jira issue
        uses: port-labs/port-github-action@v1
        with:
          clientId: ${{ secrets.PORT_CLIENT_ID }}
          clientSecret: ${{ secrets.PORT_CLIENT_SECRET }}
          operation: PATCH_RUN
          link: ${{ secrets.JIRA_BASE_URL }}/browse/${{ steps.create.outputs.issue }}
          runId: ${{ fromJson(inputs.port_payload).context.runId }}
          logMessage: |
            Jira issue created! ✅
            The issue id is: ${{ steps.create.outputs.issue }}


```
</details>

5. Trigger the action from Port's [Self Service hub](https://app.getport.io/self-serve)

6. Done! wait for the issue to be created in Jira