import GithubActionModificationHint from '../../\_github_action_modification_required_hint.mdx'
import GithubDedicatedRepoHint from '../../\_github_dedicated_workflows_repository_hint.mdx'

# Change status of Jira ticket

## Overview
This self-service guide facilitates transitioning the status of a Jira ticket from Port using Port's self service actions. With this, you can manage ticket (issue) status without leaving Port.

## Prerequisites
1. [Port's GitHub app](https://github.com/apps/getport-io) needs to be installed.
2. In your GitHub repository, [go to **Settings > Secrets**](https://docs.github.com/en/actions/security-guides/using-secrets-in-github-actions#creating-secrets-for-a-repository) and add the following secrets:
   - `JIRA_API_TOKEN` - [Jira API token](https://support.atlassian.com/atlassian-account/docs/manage-api-tokens-for-your-atlassian-account) generated by the user.
   - `JIRA_BASE_URL` - The URL of your Jira organization. For example, https://your-organization.atlassian.net.
   - `JIRA_USER_EMAIL` - The email of the Jira user that owns the Jira API token.
   - `PORT_AUTH_CLIENT_ID` - Your port `client id` [How to get the credentials](https://docs.getport.io/build-your-software-catalog/sync-data-to-catalog/api/#find-your-port-credentials).
   - `PORT_AUTH_CLIENT_SECRET` - Your port `client secret` [How to get the credentials](https://docs.getport.io/build-your-software-catalog/sync-data-to-catalog/api/#find-your-port-credentials).
3. Optional - Install Port's Jira integration [learn more](https://docs.getport.io/build-your-software-catalog/sync-data-to-catalog/jira/)

	:::tip Jira Integration
	This step is not required for this example, but it will create all the blueprint boilerplate for you, and also ingest and update the catalog in real time with your Jira Issues.
	:::

4. In Case you decided not to install the Jira integration, you will need to create a blueprint for the Jira issue in Port.

	<details>

	<summary>Jira Issue Blueprint</summary>
	
	```json showLineNumbers
	{
		"identifier": "jiraIssue",
		"title": "Jira Issue",
		"icon": "Jira",
		"schema": {
			"properties": {
				"url": {
					"title": "Issue URL",
					"type": "string",
					"format": "url",
					"description": "URL to the issue in Jira"
				},
				"status": {
					"title": "Status",
					"type": "string",
					"description": "The status of the issue"
				},
				"issueType": {
					"title": "Type",
					"type": "string",
					"description": "The type of the issue"
				},
				"components": {
					"title": "Components",
					"type": "array",
					"description": "The components related to this issue"
				},
				"assignee": {
					"title": "Assignee",
					"type": "string",
					"format": "user",
					"description": "The user assigned to the issue"
				},
				"reporter": {
					"title": "Reporter",
					"type": "string",
					"description": "The user that reported to the issue",
					"format": "user"
				},
				"creator": {
					"title": "Creator",
					"type": "string",
					"description": "The user that created to the issue",
					"format": "user"
				},
				"priority": {
					"title": "Priority",
					"type": "string",
					"description": "The priority of the issue"
				},
				"created": {
					"title": "Created At",
					"type": "string",
					"description": "The created datetime of the issue",
					"format": "date-time"
				},
				"updated": {
					"title": "Updated At",
					"type": "string",
					"description": "The updated datetime of the issue",
					"format": "date-time"
				}
			}
		},
		"calculationProperties": {},
		"relations": {}
	}
	```
	
	</details>


## GitHub Workflow

Create the file `.github/workflows/change-jira-ticket-status.yml` in the `.github/workflows` folder of your repository.

<GithubDedicatedRepoHint/>

<details>

<summary>GitHub Workflow</summary>

```yaml showLineNumbers title="change-jira-ticket-status.yml"

name: Change Jira Ticket Status
on:
  workflow_dispatch:
    inputs:
      status:
        type: string
        required: true
      port_payload:
        required: true
        description:
          Port's payload, including details for who triggered the action and
          general context (blueprint, run id, etc...)
        type: string
    secrets:
      JIRA_BASE_URL:
        required: true
      JIRA_USER_EMAIL:
        required: true
      JIRA_API_TOKEN:
        required: true
      PORT_CLIENT_ID:
        required: true
      PORT_CLIENT_SECRET:
        required: true

jobs:
  create-entity-in-port-and-update-run:
    runs-on: ubuntu-latest
    steps:
      - name: Login
        uses: atlassian/gajira-login@v3
        env:
          JIRA_BASE_URL: ${{ secrets.JIRA_BASE_URL }}
          JIRA_USER_EMAIL: ${{ secrets.JIRA_USER_EMAIL }}
          JIRA_API_TOKEN: ${{ secrets.JIRA_API_TOKEN }}

      - name: Inform starting of changing Jira ticket status
        uses: port-labs/port-github-action@v1
        with:
          clientId: ${{ secrets.PORT_CLIENT_ID }}
          clientSecret: ${{ secrets.PORT_CLIENT_SECRET }}
          operation: PATCH_RUN
          runId: ${{ fromJson(inputs.port_payload).context.runId }}
          logMessage: |
            Changing status of Jira issue... ‚õ¥Ô∏è

      - name: Transition issue
        uses: atlassian/gajira-transition@v3
        with:
          issue: ${{ fromJson(inputs.port_payload).context.entity }}
          transition: ${{ github.event.inputs.status }}

      - name: Inform that status has been changed
        uses: port-labs/port-github-action@v1
        with:
          clientId: ${{ secrets.PORT_CLIENT_ID }}
          clientSecret: ${{ secrets.PORT_CLIENT_SECRET }}
          operation: PATCH_RUN
          link: ${{ secrets.JIRA_BASE_URL }}/browse/${{ steps.create.outputs.issue }}
          runId: ${{ fromJson(inputs.port_payload).context.runId }}
          logMessage: |
            Jira issue status changed to ${{ github.event.inputs.status }}! ‚úÖ
```

</details>

## Port Configuration

1. Head to the [self-service](https://app.getport.io/self-serve) page.
2. Click on the `+ New Action` button.
3. Choose the `Jira Issue` blueprint and click `Next`.
4. Click on the `{...} Edit JSON` button.
5. Copy and paste the following JSON configuration into the editor.

<details>
<summary><b>Change status of a Jira ticket (Click to expand)</b></summary>

<GithubActionModificationHint/>

```json showLineNumbers
{
  "identifier": "change_jira_ticket_status",
  "title": "Change Jira ticket status",
  "icon": "Jira",
  "userInputs": {
    "properties": {
      "status": {
        "title": "Status",
        "type": "string",
        "enum": [
          "To Do",
          "In Progress",
          "Code Review",
          "Product Review",
          "Waiting For Prod",
          "Done"
        ],
        "enumColors": {
          "To Do": "lightGray",
          "In Progress": "bronze",
          "Code Review": "darkGray",
          "Product Review": "purple",
          "Waiting For Prod": "orange",
          "Done": "green"
        }
      }
    },
    "required": [
      "status"
    ],
    "order": []
  },
  "invocationMethod": {
    "type": "GITHUB",
    "repo": "<GITHUB_REPO>",
    "org": "<GITHUB_ORG>",
    "workflow": "change-jira-ticket-status.yml",
    "omitUserInputs": false,
    "omitPayload": false,
    "reportWorkflowStatus": true
  },
  "trigger": "DAY-2",
  "description": "Transition a ticket to another status.",
  "requiredApproval": false
}
```

</details>

6. Click `Save`.

Now you should see the `Change Jira ticket status` action in the self-service page. üéâ

## Let's test it!

1. Head to the [Self Service hub](https://app.getport.io/self-serve)
2. Click on the `Change Jira ticket status` action
3. Choose the jira ticket you want to change the status for (In case you didn't install the [Jira integration](https://docs.getport.io/build-your-software-catalog/sync-data-to-catalog/jira/), it means you don't have any Jira tickets in Port yet, so you will need to create one manually in Port to test this action)
4. Select the new status
5. Click on `Execute`
6. Done! wait for the ticket's status to be changed in Jira

Congrats üéâ You've changed a ticket status in Port üî•

## More Self Service Jira Actions Examples
- [Report a bug in Jira](https://docs.getport.io/create-self-service-experiences/setup-backend/github-workflow/examples/Jira/report-a-bug/) using Port's self-service actions
- [Open Jira issues with automatic labels](https://docs.getport.io/create-self-service-experiences/setup-backend/github-workflow/examples/Jira/open-jira-issue-with-automatic-label)
- [Open/close JIRA issues for entities with violated scorecard rules](https://docs.getport.io/promote-scorecards/manage-using-3rd-party-apps/jira)
- Add a comment to a Jira ticket using Port's self-service actions