---
displayed_sidebar: null
description: Use Port as a context lake for n8n workflows to enrich vulnerability management with service metadata, ownership, and dependencies
---

# Use Port as a context lake for n8n vulnerability management

Security teams often struggle to quickly understand the full context of vulnerabilities when they're detected. Raw vulnerability data from scanners like Snyk lacks critical operational context: which services are affected, who owns them, what environments are impacted, and what dependencies exist.

This guide demonstrates how to use **Port as a context lake** to enrich n8n workflows with comprehensive service metadata. When a vulnerability is detected, n8n queries Port's AI agent to retrieve contextual information about affected services, ownership, environments, and dependencies. This enriched context enables two powerful workflows:

1. **Targeted Slack notifications** ‚Äî Send vulnerability alerts directly to owning teams with full context
2. **AI-powered remediation** ‚Äî Route vulnerabilities to coding agents with complete service context for automated fixes

<img src='/img/guides/port-context-lake-n8n-workflow.png' border="1px" width="100%" />

## Common use cases

- **Contextual vulnerability alerts** ‚Äî Enrich security notifications with service ownership, dependencies, and environment information
- **Automated remediation routing** ‚Äî Route vulnerabilities to appropriate teams or AI agents based on service context
- **Incident management** ‚Äî Provide operational context for security incidents, outages, or deployment events
- **Cross-tool integration** ‚Äî Bridge security tools (Snyk, Wiz, SonarQube) with operational tools (Slack, Jira, PagerDuty) using Port as the central knowledge base

## Prerequisites

Before you begin, ensure you have:

- Completed the [onboarding process](/getting-started/overview)
- A Port account with [AI agents feature enabled](/ai-interfaces/ai-agents/overview#access-to-the-feature)
- Security vulnerabilities synced into Port (e.g., via [Snyk](/build-your-software-catalog/sync-data-to-catalog/code-quality-security/snyk/), [Wiz](/build-your-software-catalog/sync-data-to-catalog/code-quality-security/wiz), or [SonarQube](/build-your-software-catalog/sync-data-to-catalog/code-quality-security/sonarqube))
- Services, teams, and environments modeled in your Port catalog
- An n8n instance (cloud or self-hosted) with access to create workflows
- Port API credentials (`Client ID` and `Client Secret`) ‚Äî [learn how to get them](/build-your-software-catalog/custom-integration/api/#find-your-port-credentials)
- Slack workspace (for the notification workflow)
- OpenAI API key (for AI remediation workflow)

:::tip Context lake architecture
Port serves as a **context lake** by centralizing all service metadata, relationships, and operational data in one place. When external tools like n8n need context about services, they query Port's AI agent, which uses the catalog as a knowledge base to return structured, relevant information.
:::

## Set up the Port context retriever agent

The context retriever agent is an AI agent that uses Port's catalog as a knowledge base to provide contextual enrichment for any entity or event. It analyzes inputs (like vulnerability details) and returns structured information about affected services, owners, environments, and dependencies.

### Create the context retriever agent

1. Go to the [AI Agents](https://app.getport.io/_ai_agents) page of your portal
2. Click on `+ AI Agent`
3. Toggle `Json mode` on
4. Copy and paste the following JSON schema

    <details>
    <summary><b>Context Retriever Agent (Click to expand)</b></summary>

    ```json showLineNumbers
    {
      "identifier": "context_retriever_agent",
      "title": "Context Retriever Agent",
      "icon": "Details",
      "team": [],
      "properties": {
        "description": "AI agent that provides contextual enrichment for any entity or event using the Port catalog as a knowledge base",
        "status": "active",
        "prompt": "You are an assistant that provides **contextual enrichment** for any entity or event using the **Port catalog** as a knowledge base. Your goal is to retrieve relevant context that helps downstream systems, agents, or security teams understand how a given entity fits within the broader ecosystem.\n\nYou will receive an input describing an **entity or event**.\nAnalyze the input and use the Port catalog to return structured contextual information.\n\n**Example inputs include:**\n\n* A detected security vulnerability\n* An active incident or outage\n* A new deployment or release event\n* A system health anomaly\n\n---\n\n### **For each input, provide the following:**\n\n1. Affected service(s) or component(s)\n2. Ownership or responsible team(s)\n3. Related environments or deployment targets\n4. Dependencies or linked entities in the Port catalog (e.g., repositories, cloud resources, deployments, last N pull requests, or microservices)\n5. Any additional metadata or relationships that provide useful operational context\n\n---\n\n### **Output Format**\n\nReturn the result as **structured JSON** with the following keys:\n\n`identifier`, `title`, `related_services`, `owners`, `environments`, `dependencies`, and `notes`.\n\n**Example output:**\n\n```json\n{\n  \"identifier\": \"INC-1023\",\n  \"title\": \"Database connection timeout in payments service\",\n  \"related_services\": [\"payments-api\", \"orders-api\"],\n  \"owners\": [\"payments-team\"],\n  \"environments\": [\"production\"],\n  \"dependencies\": [\"postgres-cluster-prod\", \"redis-cache\"],\n  \"notes\": \"The issue affects all payment operations in production. Linked to previous incident INC-1009.\"\n}\n```\n\nIf a field cannot be determined, return it as an empty string or an empty list.",
        "execution_mode": "Automatic",
        "tools": [
          "^(list|get|search|track|describe)_.*"
        ]
      },
      "relations": {}
    }
    ```
    </details>

5. Click `Create` to save the agent


## Set up the n8n workflow

Now we will set up an n8n workflow that demonstrates Port as a context lake. The workflow receives vulnerability alerts, queries Port for context, and then routes to either Slack notifications or AI remediation.

### Import the n8n workflow template

1. Open your n8n instance
2. Click on **Workflows** ‚Üí **Import from File** or **Import from URL**
3. Copy the workflow JSON from the template below

    <details>
    <summary><b>n8n Workflow Template (Click to expand)</b></summary>

    ```json showLineNumbers
    {
      "name": "AI-Assisted Vulnerability Remediation",
      "nodes": [
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "security/vulnerability_detected",
            "options": {}
          },
          "name": "Webhook Trigger",
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 1,
          "position": [
            -1200,
            112
          ],
          "webhookDescription": "Triggered when a new vulnerability is detected",
          "id": "ce466e00-5ed8-4caf-aeb2-603cc15be4b3",
          "webhookId": "67326f7b-22c3-46c0-9f9f-805fc1401647"
        },
        {
          "parameters": {
            "resource": "chat",
            "model": "o4-mini",
            "prompt": {
              "messages": [
                {
                  "content": "=You are a cybersecurity assistant. Given the following vulnerability details, summarize the issue, assess impact, and generate a clear remediation plan.\n\nVulnerability:{{ $('Webhook Trigger').item.json.body.vulnerability_id }}\nDescription: {{ $('Webhook Trigger').item.json.body.description }}\nSeverity: {{ $('Webhook Trigger').item.json.body.severity }}\n\nContext:{{$json.result.message}}\n\nOutput format (strict JSON):{\"summary\":\"\",\"impact\": \"\", \"remediation_plan\": \"\", \"is_fixable\": boolean true or false}"
                }
              ]
            },
            "options": {},
            "requestOptions": {}
          },
          "name": "OpenAI Remediation Plan",
          "type": "n8n-nodes-base.openAi",
          "typeVersion": 1,
          "position": [
            16,
            112
          ],
          "id": "c341f96e-0fa7-483b-bac3-4c5ae598162f",
          "credentials": {
            "openAiApi": {
              "id": "QZoKpvSIXoNqzm06",
              "name": "OpenAi account"
            }
          }
        },
        {
          "parameters": {
            "channel": "#security-updates",
            "text": "=‚ö†Ô∏è *AI Remediation Workflow Error*\nNode: {{$node.name}}\nError: {{$error.message}}",
            "otherOptions": {},
            "attachments": []
          },
          "name": "Error Alert Slack",
          "type": "n8n-nodes-base.slack",
          "typeVersion": 1,
          "position": [
            -896,
            352
          ],
          "id": "3ce14f5b-6929-4aa0-acc0-2e062ee798a7",
          "credentials": {
            "slackApi": {
              "id": "PcHkxZHMrun5N8Tk",
              "name": "Slack account"
            }
          }
        },
        {
          "parameters": {},
          "name": "Error Trigger",
          "type": "n8n-nodes-base.errorTrigger",
          "typeVersion": 1,
          "position": [
            -1200,
            352
          ],
          "id": "d914a815-c3cd-4837-9d77-b6c8adb7b218"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "1f932476-fbff-4207-a8cd-0dae1a31e8c4",
                  "name": "invocationIdentifier",
                  "value": "={{$json[\"data\"].match(/event:\\s*invocationIdentifier\\s*data:\\s*([^\\n]+)/)[1]}}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -480,
            112
          ],
          "id": "65c6970a-76f6-45eb-9b67-69037b25b094",
          "name": "Get Port Invocation ID"
        },
        {
          "parameters": {
            "url": "=https://api.port.io/v1/ai/invoke/{{ $json.invocationIdentifier }}",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpBearerAuth",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.3,
          "position": [
            -272,
            112
          ],
          "id": "e3e160cd-3d23-4a57-9a9b-f3f404d4f02d",
          "name": "Get Port AI Response",
          "credentials": {
            "httpBearerAuth": {
              "id": "YQPDVt4hWphgX1rz",
              "name": "Bearer Auth account"
            }
          }
        },
        {
          "parameters": {
            "channel": "<DEFAULT_SLACK_CHANNEL>",
            "text": "={{ \n`üö® *Vulnerability Alert*\n\n*ID:* ${$('Webhook Trigger').item.json.body.vulnerability_id}\n*Severity:* ${$('Webhook Trigger').item.json.body.severity}\n*Summary:* ${$node[\"OpenAI Remediation Plan\"].json[\"message\"][\"content\"].parseJson().summary}\n*Impact:* ${$node[\"OpenAI Remediation Plan\"].json[\"message\"][\"content\"].parseJson().impact}\n*Remediation Plan:* ${$node[\"OpenAI Remediation Plan\"].json[\"message\"][\"content\"].parseJson().remediation_plan}\n\n_Workflow: AI-Assisted Remediation_`\n}}\n",
            "otherOptions": {},
            "attachments": []
          },
          "name": "Send Slack Message",
          "type": "n8n-nodes-base.slack",
          "typeVersion": 1,
          "position": [
            912,
            128
          ],
          "id": "39e20367-b69c-456b-b7dc-79d0bc5f80e1",
          "credentials": {
            "slackApi": {
              "id": "PcHkxZHMrun5N8Tk",
              "name": "Slack account"
            }
          }
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://api.port.io/v1/auth/access_token",
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "{\n  \"clientId\":\"<PORT_CLIENT_ID>\",\n  \"clientSecret\": \"<PORT_CLIENT_SECRET>\"\n}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.3,
          "position": [
            -944,
            112
          ],
          "id": "bd4db720-50f7-4098-b4c7-84a5a30faf38",
          "name": "Get Port Access Token",
          "retryOnFail": true,
          "maxTries": 2
        },
        {
          "parameters": {
            "conditions": {
              "boolean": [
                {
                  "value1": "={{ $json.message.content.parseJson().is_fixable }}",
                  "value2": "={{ true }}"
                }
              ]
            }
          },
          "name": "Is Fixable?",
          "type": "n8n-nodes-base.if",
          "typeVersion": 1,
          "position": [
            320,
            112
          ],
          "id": "25207171-b1cf-4223-9155-674ccb7d59ad"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://api.port.io/v1/agent/context_retriever_agent/invoke",
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "Authorization",
                  "value": "=Bearer {{ $json.accessToken }}"
                }
              ]
            },
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "={\n  \"prompt\": \"You are an assistant that provides contextual enrichment for vulnerabilities using the Port catalog as a knowledge base. A new security vulnerability has been detected.\\n\\nVulnerability Details:\\n- Identifier:{{ $('Webhook Trigger').item.json.body.vulnerability_id }}\\n- Description:{{ $('Webhook Trigger').item.json.body.description }}\\n-Severity:{{ $('Webhook Trigger').item.json.body.severity }}\\n\\nUsing the Port catalog (which stores data about services, components, environments, owners, and relationships), return relevant contextual information that will help downstream AI agents or security teams understand how this vulnerability relates to other entities. Specifically, retrieve:\\n\\n1. The affected service(s) or components linked to this vulnerability\\n2. Ownership or responsible team(s)\\n3. Related environments or deployment targets\\n4. Dependencies or linked entities in the Port catalog (for example, linked repositories, cloud resources, or microservices)\\n5. Any additional metadata that can help prioritize or triage this vulnerability.\\n\\nFormat the response as structured JSON with the following keys: `identifier`, `title`, `related_services`, `owners`, `environments`, `dependencies`, and `notes`.\",\n  \"labels\": {\n    \"source\": \"n8n-workflow\",\n    \"use_case\": \"vulnerability-context-enrichment\"\n  },\n  \"provider\": \"openai\",\n  \"model\": \"gpt-5\"\n}",
            "options": {}
          },
          "name": "Get Context From Port AI",
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 3,
          "position": [
            -688,
            112
          ],
          "id": "f08cf680-ae0b-43f0-90b8-3ff6763c5071"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://api.getport.io/v1/actions/run_claude_code_demo/runs",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpBearerAuth",
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "={{ {\n  properties: {\n    service: \"port-labs/port-product-experiments\",\n    prompt: \"Generate a code fix for the security vulnerability based on the AI-provided summary \" + $json.message.content.parseJson().summary + \".\\n\\nHere is the information about the security vulnerability remediation plan:\\n\" + $json.message.content.parseJson().remediation_plan + \"\\n\\nAfter generating the code, open a PR with a description summarizing what was fixed and why.\"\n  }\n} }}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.3,
          "position": [
            528,
            16
          ],
          "id": "53c493cd-73b3-40e6-a128-723dafeefd52",
          "name": "Trigger Claude Code",
          "credentials": {
            "httpBearerAuth": {
              "id": "YQPDVt4hWphgX1rz",
              "name": "Bearer Auth account 2"
            }
          }
        }
      ],
      "pinData": {},
      "connections": {
        "Webhook Trigger": {
          "main": [
            [
              {
                "node": "Get Port Access Token",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "OpenAI Remediation Plan": {
          "main": [
            [
              {
                "node": "Is Fixable?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Error Trigger": {
          "main": [
            [
              {
                "node": "Error Alert Slack",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get Port Invocation ID": {
          "main": [
            [
              {
                "node": "Get Port AI Response",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get Port AI Response": {
          "main": [
            [
              {
                "node": "OpenAI Remediation Plan",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get Port Access Token": {
          "main": [
            [
              {
                "node": "Get Context From Port AI",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Is Fixable?": {
          "main": [
            [
              {
                "node": "Trigger Claude Code",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Send Slack Message",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get Context From Port AI": {
          "main": [
            [
              {
                "node": "Get Port Invocation ID",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Trigger Claude Code": {
          "main": [
            [
              {
                "node": "Send Slack Message",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "active": false,
      "settings": {
        "executionOrder": "v1"
      },
      "versionId": "ce09cd28-5e8d-46d8-8be7-2b218ada62e8",
      "meta": {
        "templateCredsSetupCompleted": true,
        "instanceId": "57cabc97f5371cccae88962f9b85d6b16e885a8ed8caff8f55d3bae5e8f8d345"
      },
      "id": "qdLTElqTOiegTd6y",
      "tags": []
    }
    ```
    </details>

4. After importing, configure the following credentials in n8n:
   - **Port API credentials** ‚Äî Create an HTTP Bearer Auth credential with your Port access token (or use the OAuth flow)
   - **Slack credentials** ‚Äî Add your Slack API token
   - **OpenAI credentials** ‚Äî Add your OpenAI API key

### Configure the workflow

The workflow consists of several key nodes:

1. **Webhook Trigger** ‚Äî Receives vulnerability alerts from Snyk or other security scanners
2. **Get Port Access Token** ‚Äî Authenticates with Port API
3. **Get Context From Port AI** ‚Äî Queries the context retriever agent for service metadata
4. **Get Port Invocation ID** ‚Äî Extracts the invocation identifier from the response
5. **Get Port AI Response** ‚Äî Retrieves the full AI response with context
6. **OpenAI Remediation Plan** ‚Äî Generates a remediation plan using the enriched context
7. **Is Fixable?** ‚Äî Routes to either automated fix or notification
8. **Trigger Claude Code** ‚Äî (Optional) Triggers automated code fix
9. **Send Slack Message** ‚Äî Sends notification to Slack with context

:::caution Update API endpoints
Make sure to update the Port API endpoints in the workflow to match your Port region:
- US: `https://api.us.port.io`
- EU: `https://api.getport.io`

Also update the `clientId` and `clientSecret` in the "Get Port Access Token" node with your actual Port credentials.
:::

## Workflow patterns

The n8n workflow demonstrates two primary patterns for using Port as a context lake:

### Pattern 1: Targeted Slack notifications

When a vulnerability is detected, the workflow:

1. Receives the vulnerability alert via webhook
2. Queries Port's context retriever agent to get:
   - Affected services
   - Owning teams
   - Related environments
   - Dependencies
3. Sends a targeted Slack notification to the owning team with full context

This ensures security alerts reach the right people with all the information they need to prioritize and respond.

### Pattern 2: AI-powered remediation

For fixable vulnerabilities, the workflow:

1. Retrieves context from Port (same as Pattern 1)
2. Generates a remediation plan using OpenAI with the enriched context
3. Routes to Claude Code (or another coding agent) to automatically generate a fix
4. Opens a pull request with the fix

The Port context ensures the AI agent understands the service architecture, dependencies, and best practices before generating code.

## Test the workflow

### Test with a sample vulnerability

1. **Trigger the webhook** with a sample payload:

    ```json
    {
      "vulnerability_id": "CVE-2024-12345",
      "description": "SQL injection vulnerability in authentication service",
      "severity": "high"
    }
    ```

2. **Verify Port context retrieval** ‚Äî Check that the "Get Context From Port AI" node successfully retrieves:
   - Related services
   - Ownership information
   - Environment details
   - Dependencies

3. **Check Slack notification** ‚Äî Verify the notification includes:
   - Vulnerability details
   - Service context from Port
   - Remediation plan

4. **Verify AI remediation** (if applicable) ‚Äî Confirm that fixable vulnerabilities trigger the coding agent with proper context

## Related guides

- [Remediate vulnerabilities with AI](/guides/all/remediate-vulnerability-with-ai) ‚Äî Use Port AI agents to automatically enrich and fix vulnerabilities
- [Trigger Claude Code from Port](/guides/all/trigger-claude-code-from-port) ‚Äî Set up Claude Code integration with Port
- [Set up the Task Manager AI agent](/guides/all/setup-task-manager-ai-agent) ‚Äî Create an AI agent to manage and prioritize development tasks

