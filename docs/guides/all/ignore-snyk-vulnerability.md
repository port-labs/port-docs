---
displayed_sidebar: null
description: Learn how to ignore a synk vulnerability
---

import ExistingSecretsCallout from '/docs/guides/templates/secrets/_existing_secrets_callout.mdx'
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Ignore Snyk Vulnerability

## Overview
This guide demonstrates how to implement a self-service action in Port that allows you to ignore a Snyk vulnerability.


## Prerequisites

- Complete the [onboarding process](/getting-started/overview).
- Access to your Snyk organization with permissions to manage vulnerabilities.
- Optional - Install Port's [Snyk integration](https://docs.port.io/build-your-software-catalog/sync-data-to-catalog/code-quality-security/snyk/).

## Set up data model

If you haven't installed Port's [Snyk integration](https://docs.port.io/build-your-software-catalog/sync-data-to-catalog/code-quality-security/snyk/)., you will need to manually create blueprints for `Snyk project` and `Snyk vulnerability`.  
We highly recommend that you install the Snyk integration to have such resources automatically set up for you. 

### Create the Snyk project blueprint

1. Go to your [Builder](https://app.getport.io/settings/data-model) page.
2. Click on `+ Blueprint`.
3. Click on the `{...}` button in the top right corner, and choose `Edit JSON`.
4. Add this JSON schema:
    <details>
    <summary><b>Snyk Project Blueprint (Click to expand)</b></summary>

    ```json showLineNumbers
    {
        "identifier": "snykProject",
        "title": "Snyk Project",
        "icon": "Snyk",
        "schema": {
        "properties": {
            "url": {
            "type": "string",
            "title": "URL",
            "format": "url",
            "icon": "Snyk"
            },
            "businessCriticality": {
            "title": "Business Criticality",
            "type": "array",
            "items": {
                "type": "string",
                "enum": [
                "critical",
                "high",
                "medium",
                "low"
                ]
            },
            "icon": "DefaultProperty"
            },
            "environment": {
            "items": {
                "type": "string",
                "enum": [
                "frontend",
                "backend",
                "internal",
                "external",
                "mobile",
                "saas",
                "onprem",
                "hosted",
                "distributed"
                ]
            },
            "icon": "Environment",
            "title": "Environment",
            "type": "array"
            },
            "lifeCycle": {
            "title": "Life Cycle",
            "type": "array",
            "items": {
                "type": "string",
                "enum": [
                "development",
                "sandbox",
                "production"
                ]
            },
            "icon": "DefaultProperty"
            },
            "criticalOpenVulnerabilities": {
            "icon": "Vulnerability",
            "type": "number",
            "title": "Open Critical Vulnerabilities"
            },
            "highOpenVulnerabilities": {
            "icon": "Vulnerability",
            "type": "number",
            "title": "Open High Vulnerabilities"
            },
            "mediumOpenVulnerabilities": {
            "icon": "Vulnerability",
            "type": "number",
            "title": "Open Medium Vulnerabilities"
            },
            "lowOpenVulnerabilities": {
            "icon": "Vulnerability",
            "type": "number",
            "title": "Open Low Vulnerabilities"
            },
            "tags": {
            "type": "array",
            "title": "Tags",
            "icon": "DefaultProperty"
            },
            "targetOrigin": {
            "type": "string",
            "title": "Target Origin"
            }
        },
        "required": []
        },
        "mirrorProperties": {},
        "calculationProperties": {},
        "aggregationProperties": {},
        "relations": {}
    }
    ```
    </details>

5. Click `Save` to create the blueprint.

### Create or update the Snyk vulnerability blueprint

In this setup, we will create or update the `Snyk Vulnerability` blueprint.      
**Skip** to the [update blueprint](#update-the-blueprint) section if you already have the blueprint.

#### Create the Snyk vulnerability blueprint

If you have not installed Port's Snyk integration, you need to manually create the `Snyk Vulnerability` blueprint.   Follow the steps below to add the blueprint:

1. Go to your [Builder](https://app.getport.io/settings/data-model) page.
2. Click on `+ Blueprint`.
3. Click on the `{...}` button in the top right corner, and choose `Edit JSON`.
4. Add this JSON schema:

    <details>
    <summary><b>Snyk Vulnerability Blueprint (Click to expand)</b></summary>

    ```json showLineNumbers
    {
    "identifier": "snykVulnerability",
    "title": "Snyk Vulnerability",
    "icon": "Snyk",
    "schema": {
        "properties": {
        "score": {
            "icon": "Star",
            "type": "number",
            "title": "Score"
        },
        "packageNames": {
            "items": {
            "type": "string"
            },
            "type": "array",
            "title": "Package Names",
            "icon": "DefaultProperty"
        },
        "packageVersions": {
            "icon": "Package",
            "title": "Package Versions",
            "type": "array"
        },
        "type": {
            "icon": "DefaultProperty",
            "title": "Type",
            "type": "string",
            "enum": [
            "vuln",
            "license",
            "configuration",
            "config",
            "custom",
            "code",
            "cloud",
            "package_vulnerability"
            ]
        },
        "severity": {
            "icon": "Alert",
            "title": "Issue Severity",
            "type": "string",
            "enum": [
            "low",
            "medium",
            "high",
            "critical"
            ],
            "enumColors": {
            "low": "green",
            "medium": "yellow",
            "high": "red",
            "critical": "red"
            }
        },
        "url": {
            "icon": "Link",
            "type": "string",
            "title": "Issue URL",
            "format": "url"
        },
        "publicationTime": {
            "type": "string",
            "format": "date-time",
            "title": "Publication Time",
            "icon": "DefaultProperty"
        },
        "status": {
            "title": "Status",
            "icon": "",
            "type": "string",
            "enum": [
            "open",
            "resolved"
            ],
            "enumColors": {
            "open": "red",
            "resolved": "green"
            }
        },
        "issueKey": {
            "type": "string",
            "title": "Issue Key"
        }
        },
        "required": []
    },
    "mirrorProperties": {},
    "calculationProperties": {},
    "aggregationProperties": {},
    "relations": {
        "project": {
        "title": "Project",
        "target": "snykProject",
        "required": false,
        "many": false
        }
    }
    }
    ```
    </details>
5. Click `Save` to create the blueprint.

#### Update the Snyk vulnerability blueprint

If you have installed Port's Snyk integration, you need to add the `issueKey` property to the `Snyk Vulnerability` blueprint. Follow the steps below to add the property:

1. Go to your [Builder](https://app.getport.io/settings/data-model) page.
2. Search for the `Snyk Vulnerability` blueprint.
3. Click on the `{...} Edit JSON` button.
4. Copy and paste the following JSON snippet into properties.
        <details>
      <summary><b>Issue key property (click to expand)</b></summary>
    
    
    ```json showLineNumbers
    "issueKey": {
      "title": "Issue Key",
      "type": "string"
    }
    ```
    </details>

5. Click `Save` to update the blueprint.

### Update Synk integration configuration 

1. Go to your [Data Source](https://app.getport.io/settings/data-sources) page.
2. Select the Snyk ocean integration.
3. Add the following YAML block into the editor to update the vulnerability data:

    <details>
    <summary><b>Snyk Vulnerability Configuration (Click to expand)</b></summary>
    ```yaml showLineNumbers
    - kind: vulnerability
        selector:
        query: 'true'
        port:
        entity:
            mappings:
            identifier: .id
            title: .attributes.title
            blueprint: '"snykVulnerability"'
            properties:
                score: .attributes.risk.score.value
                packageNames: [.attributes.coordinates[].representations[].dependency?.package_name
                | select(. != null)]
                packageVersions: [.attributes.coordinates[].representations[].dependency?.package_version
                | select(. != null)]
                severity: .attributes.effective_severity_level
                url: ("https://app.snyk.io/org/" + .attributes.key | tostring)
                publicationTime: .attributes.created_at
                status: .attributes.status
                type: .attributes.type
                # highlight-start
                issueKey: .attributes.key
                # highlight-end
            relations:
                project: .relationships.scan_item.data.id
    ```
    </details>
    
4. Click `Save & Resync` to apply the mapping.


## Implementation

You can ignore Snyk vulnerability by leveraging Port's **synced webhooks** and **secrets** to directly interact with Snyk's API.

### Add Port secrets

<ExistingSecretsCallout integration="Snyk" />

To add these secrets to your portal:

1. Click on the `...` button in the top right corner of your Port application.

2. Click on **Credentials**.

3. Click on the `Secrets` tab.

4. Click on `+ Secret` and add the following secrets:
    - `_SNYK_TOKEN`: Your [Snyk API key](https://docs.snyk.io/snyk-api/rest-api/authentication-for-api).
    - `_SNYK_ORGANIZATION_ID`: Your Snyk organization ID.


### Set up self-service action

Follow these steps to create the self-service action:

1. Head to the [self-service](https://app.getport.io/self-serve) page.
2. Click on the `+ New Action` button.
3. Click on the `{...} Edit JSON` button.
4. Copy and paste the following JSON configuration into the editor.

    <details>
    <summary><b>Ignore Snyk Vulnerability (Click to expand)</b></summary>

    ```json showLineNumbers
    {
    "identifier": "ignore_snyk_vulnerability",
    "title": "Ignore Snyk Vulnerability",
    "icon": "Snyk",
    "description": "Ignore a Snyk vulnerability with reason and expiration date.",
    "trigger": {
        "type": "self-service",
        "operation": "DAY-2",
        "userInputs": {
        "properties": {
            "reasonType": {
            "type": "string",
            "title": "Reason Type",
            "enum": [
                "wont-fix",
                "not-vulnerable",
                "temporary-ignore"
            ],
            "enumColors": {
                "wont-fix": "lightGray",
                "not-vulnerable": "lightGray",
                "temporary-ignore": "lightGray"
            }
            },
            "ignoreReason": {
            "type": "string",
            "title": "Ignore Reason"
            },
            "expiration": {
            "type": "string",
            "enum": [
                "Does not expire",
                "Custom expiration date"
            ],
            "title": "Expiration"
            },
            "expirationDate": {
            "type": "string",
            "enum": [
                "30 days",
                "60 days",
                "90 days",
                "180 days",
                "270 days",
                "365 days"
            ],
            "visible": {
                "jqQuery": ".form.expiration == \"Custom expiration date\""
            },
            "title": "Expiration Date"
            }
        },
        "required": [
            "reasonType",
            "expiration"
        ],
        "order": []
        },
        "blueprintIdentifier": "snykVulnerability"
    },
    "invocationMethod": {
        "type": "WEBHOOK",
        "url": "https://api.snyk.io/v1/org/{{ .secrets._SNYK_ORGANIZATION_ID }}/project/{{ .entity.relations.project }}/ignore/{{ .entity.properties.issueKey }}",
        "agent": false,
        "synchronized": true,
        "method": "POST",
        "headers": {
        "Authorization": "token {{ .secrets._SNYK_TOKEN }}",
        "Content-Type": "application/json"
        },
        "body": {
        "ignorePath": "",
        "reason": "{{ .inputs.ignoreReason }}",
        "reasonType": "{{ .inputs.reasonType }}",
        "ignoredBy": {
            "name": "{{ .trigger.by.user.firstName }}",
            "email": "{{ .trigger.by.user.email }}",
            "id": "{{ .trigger.by.user.id }}"
        },
        "disregardIfFixable": false,
        "{{ if (.inputs | has(\"expirationDate\")) then \"expires\" else null end }}": "{{ if (.inputs | has(\"expirationDate\")) then (( .inputs.expirationDate | sub(\" days\"; \"\") | tonumber) * 86400 | now + . | strftime(\"%Y-%m-%dT%H:%M:%S%z\")) else null end }}",
        "created": "{{ .trigger.at }}"
        }
    },
    "requiredApproval": false
    }
    ```
    </details>

5. Click `Save`.

Now you should see the `Ignore Snyk Vulnerability` action in the self-service page. ðŸŽ‰


## Let's test it!

1. Head to the [self-service page](https://app.getport.io/self-serve) of your portal.

2. Choose the `Ignore Snyk Vulnerability` action:

3. Enter the required information:
   - Select the vulnerability entity.
   - Select the reason type.
   - Select expiration date.
   - Enter the ignore reason.

4. Click on `Execute`.

5. Done! Wait for the issue to be ignored in Snyk.  ðŸŽ‰

    <img src="/img/guides/ignoreSnykIssue.png" width="600px" border="1px" />
