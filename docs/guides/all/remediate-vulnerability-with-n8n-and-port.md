---
displayed_sidebar: null
description: Use Port as a context lake for n8n workflows to enrich vulnerability management with service metadata, ownership, and dependencies
---

# Remediate security vulnerability with n8n and Port AI

Security teams often struggle to quickly understand the full context of vulnerabilities when they're detected. Raw vulnerability data from scanners like Snyk lacks critical operational context: which services are affected, who owns them, what environments are impacted, and what dependencies exist.

This guide demonstrates how to use **Port as a context lake** to enrich n8n workflows with comprehensive service metadata. When a vulnerability is detected, n8n queries Port's AI agent to retrieve contextual information about affected services, ownership, environments, and dependencies. This enriched context enables two powerful workflows:

1. **Targeted Slack notifications** ‚Äî Send vulnerability alerts directly to owning teams with full context
2. **AI-powered remediation** ‚Äî Route vulnerabilities to coding agents with complete service context for automated fixes

<img src='/img/guides/port-context-lake-n8n-workflow.png' border="1px" width="100%" />

## Common use cases

- **Contextual vulnerability alerts** ‚Äî Enrich security notifications with service ownership, dependencies, and environment information
- **Automated remediation routing** ‚Äî Route vulnerabilities to appropriate teams or AI agents based on service context
- **Incident management** ‚Äî Provide operational context for security incidents, outages, or deployment events

## Prerequisites

Before you begin, ensure you have:

- Completed the [onboarding process](/getting-started/overview)
- A Port account with [AI agents feature enabled](/ai-interfaces/ai-agents/overview#access-to-the-feature)
- Security vulnerabilities synced into Port (e.g., via [Snyk](/build-your-software-catalog/sync-data-to-catalog/code-quality-security/snyk/), [Wiz](/build-your-software-catalog/sync-data-to-catalog/code-quality-security/wiz), or [SonarQube](/build-your-software-catalog/sync-data-to-catalog/code-quality-security/sonarqube))
- You have completed the setup in the [Set up Port's n8n custom node guide](../all/setup-port-n8n-node.md)
- You have completed the setup in the [Trigger Claude Code from Port guide](https://docs.port.io/guides/all/trigger-claude-code-from-port) (Optional)
- Slack workspace and [developer token](https://api.slack.com/) (for the notification workflow)
- [OpenAI API key](https://platform.openai.com/api-keys) (for AI remediation workflow)


## Set up the Port context retriever agent

The context retriever agent is an AI agent that uses Port's catalog as a knowledge base to provide contextual enrichment for any entity or event. It analyzes inputs (like vulnerability details) and returns structured information about affected services, owners, environments, scorecards, dependencies and more.

### Create the context retriever agent

1. Go to the [AI Agents](https://app.getport.io/_ai_agents) page of your portal
2. Click on `+ AI Agent`
3. Toggle `Json mode` on
4. Copy and paste the following JSON schema

    <details>
    <summary><b>Context Retriever Agent (Click to expand)</b></summary>

    ```json showLineNumbers
    {
      "identifier": "context_retriever_agent",
      "title": "Context Retriever Agent",
      "icon": "Details",
      "team": [],
      "properties": {
        "description": "AI agent that provides contextual enrichment for any entity or event using the Port catalog as a knowledge base",
        "status": "active",
        "prompt": "You are an assistant that provides **contextual enrichment** for any entity or event using the **Port catalog** as a knowledge base. Your goal is to retrieve relevant context that helps downstream systems, agents, or security teams understand how a given entity fits within the broader ecosystem.\n\nYou will receive an input describing an **entity or event**.\nAnalyze the input and use the Port catalog to return structured contextual information.\n\n**Example inputs include:**\n\n* A detected security vulnerability\n* An active incident or outage\n* A new deployment or release event\n* A system health anomaly\n\n---\n\n### **For each input, provide the following:**\n\n1. Affected service identifier\n2. Ownership or responsible team(s)\n3. Communication channels such as Slack channel name\n4. Related environments or deployment targets\n5. Dependencies or linked entities in the Port catalog (e.g., repositories, cloud resources, deployments, last X pull requests, or issues)\n6. Relevant scorecards the define and track engineering standards, KPIs, and quality metrics\n7. Any additional metadata or relationships that provide useful operational context\n\n---\n\n### **Output Format**\n\nReturn the result as **structured JSON** with the following keys:\n\n`identifier`, `title`, `related_services`, `owners`, `slack_channel`, `environments`, `dependencies`, `scorecards` and `notes`.\n\n**Example output:**\n\n```json\n{\n  \"identifier\": \"INC-1023\",\n  \"title\": \"Database connection timeout in payments service\",\n  \"affected_service\": \"port-labs/payment-service\",\n  \"owners\": [\"payments-team\"],\n  \"slack_channel\": \"tech-general\",\n  \"environments\": [\"production\"],\n  \"dependencies\": [\"postgres-cluster-prod\", \"redis-cache\"],\n  \"scorecards\": [\"production-readiness not met\", \"code maturity passed\"],\n  \"notes\": \"The issue affects all payment operations in production. Linked to previous incident INC-1009.\"\n}\n```\n\nIf a field cannot be determined, return it as an empty string or an empty list.",
        "execution_mode": "Automatic",
        "tools": [
          "^(list|get|search|track|describe)_.*"
        ]
      },
      "relations": {}
    }
    ```
    </details>

5. Click `Create` to save the agent


## Import the n8n workflow template

1. Open your n8n instance
2. Click on **Workflows** ‚Üí **Import from File** or **Import from URL**
3. Copy the workflow JSON from the template below

    <details>
    <summary><b>n8n Workflow Template (Click to expand)</b></summary>

    ```json showLineNumbers
    {
      "name": "AI-Assisted Vulnerability Remediation",
      "nodes": [
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "security/vulnerability_detected",
            "options": {}
          },
          "name": "Webhook Trigger",
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 1,
          "position": [
            -928,
            96
          ],
          "webhookDescription": "Triggered when a new vulnerability is detected",
          "id": "da38b906-9eda-4157-891e-13f828cb9b5c",
          "webhookId": "67326f7b-22c3-46c0-9f9f-805fc1401647"
        },
        {
          "parameters": {
            "resource": "chat",
            "model": "gpt-4o-mini",
            "prompt": {
              "messages": [
                {
                  "content": "=You are a cybersecurity assistant. Given the following vulnerability details, summarize the issue, assess impact, and generate a clear remediation plan.\n\nVulnerability:{{ $('Webhook Trigger').item.json.body.vulnerability_id }}\nDescription: {{ $('Webhook Trigger').item.json.body.description }}\nSeverity: {{ $('Webhook Trigger').item.json.body.severity }}\n\nContext: {{ $json.result.message }}\n\nYour response must be a single valid JSON object only, without any code block formatting, markdown, explanations, or extra text.  \nDo not include ```json or ``` or any surrounding characters ‚Äî just raw JSON.\n\nRequired output schema:\n{\n  \"summary\": \"\",\n  \"impact\": \"\",\n  \"remediation_plan\": \"\",\n  \"is_fixable\": boolean true or false\n}"
                }
              ]
            },
            "options": {},
            "requestOptions": {}
          },
          "name": "OpenAI Remediation Plan",
          "type": "n8n-nodes-base.openAi",
          "typeVersion": 1,
          "position": [
            -64,
            96
          ],
          "id": "b72c278e-6aaa-4b51-873c-921c0d4d0dab",
          "credentials": {
            "openAiApi": {
              "id": "jsaQyiVUkiZdKJuz",
              "name": "OpenAi account"
            }
          }
        },
        {
          "parameters": {
            "channel": "#security-updates",
            "text": "=‚ö†Ô∏è *AI Remediation Workflow Error*\nNode: {{$node.name}}\nError: {{$error.message}}",
            "otherOptions": {},
            "attachments": []
          },
          "name": "Error Alert Slack",
          "type": "n8n-nodes-base.slack",
          "typeVersion": 1,
          "position": [
            -384,
            320
          ],
          "id": "f8f1726a-df54-48d4-adb7-005a49bfa541",
          "credentials": {
            "slackApi": {
              "id": "GoOLAtWBRwTADKc8",
              "name": "Slack account"
            }
          }
        },
        {
          "parameters": {},
          "name": "Error Trigger",
          "type": "n8n-nodes-base.errorTrigger",
          "typeVersion": 1,
          "position": [
            -848,
            320
          ],
          "id": "a7cf6d6c-e1eb-4d90-afd0-e714d92c7a54"
        },
        {
          "parameters": {
            "channel": "={{ $('Process Port AI Response').item.json.result.message.parseJson().slack_channel || \"<DEFAULT_SLACK_CHANNEL>\" }}",
            "text": "={{ \n`üö® *Vulnerability Alert*\n\n*ID:* ${$('Webhook Trigger').item.json.body.vulnerability_id}\n*Severity:* ${$('Webhook Trigger').item.json.body.severity}\n*Summary:* ${$node[\"OpenAI Remediation Plan\"].json[\"message\"][\"content\"].parseJson().summary}\n*Impact:* ${$node[\"OpenAI Remediation Plan\"].json[\"message\"][\"content\"].parseJson().impact}\n*Remediation Plan:* ${$node[\"OpenAI Remediation Plan\"].json[\"message\"][\"content\"].parseJson().remediation_plan}\n\n_Workflow: AI-Assisted Remediation_`\n}}\n",
            "otherOptions": {},
            "attachments": []
          },
          "name": "Send Slack Message",
          "type": "n8n-nodes-base.slack",
          "typeVersion": 1,
          "position": [
            800,
            112
          ],
          "id": "8bfb94df-43ca-42f8-8b81-aad696ec540d",
          "credentials": {
            "slackApi": {
              "id": "GoOLAtWBRwTADKc8",
              "name": "Slack account"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "boolean": [
                {
                  "value1": "={{ $json.message.content.parseJson().is_fixable }}",
                  "value2": "={{ true }}"
                }
              ]
            }
          },
          "name": "Is Fixable?",
          "type": "n8n-nodes-base.if",
          "typeVersion": 1,
          "position": [
            208,
            96
          ],
          "id": "7493e053-5178-48f4-bbef-71daecaa399f"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://api.getport.io/v1/actions/run_claude_code_demo/runs",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpBearerAuth",
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "={{ {\n  properties: {\n    service: $('Process Port AI Response').item.json.result.message.parseJson().affected_service || \"<OWNER/REPO>\",\n    prompt: \"Generate a code fix for the security vulnerability based on the AI-provided summary \" + $json.message.content.parseJson().summary + \".\\n\\nHere is the information about the security vulnerability remediation plan:\\n\" + $json.message.content.parseJson().remediation_plan + \"\\n\\nAfter generating the code, open a PR with a description summarizing what was fixed and why.\"\n  }\n} }}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.3,
          "position": [
            496,
            -128
          ],
          "id": "ad946b73-bc0d-4caf-8907-99d6cd6d2671",
          "name": "Trigger Claude Code",
          "credentials": {
            "httpBearerAuth": {
              "id": "w6HyPPyI9LWW6Xgl",
              "name": "Bearer Auth account"
            }
          }
        },
        {
          "parameters": {
            "agentIdentifier": "context_retriever_agent",
            "prompt": "=You are an assistant that provides contextual enrichment for vulnerabilities using the Port catalog as a knowledge base. A new security vulnerability has been detected.\nVulnerability Details:\n- Identifier:{{ $('Webhook Trigger').item.json.body.vulnerability_id }}\n- Description:{{ $('Webhook Trigger').item.json.body.description }}\n- Severity:{{ $('Webhook Trigger').item.json.body.severity }}\n\nUsing the Port catalog (which stores data about services, components, environments, owners, and relationships), return relevant contextual information that will help downstream AI agents or security teams understand how this vulnerability relates to other entities. Specifically, retrieve:\n1. The affected service or repo linked to this vulnerability\n2. Ownership or responsible team(s)\n3. Communication channels such as Slack channel name\n4. Related environments or deployment targets\n5. Dependencies or linked entities in the Port catalog (for example, linked repositories, cloud resources, or microservices)\n6. Any additional metadata that can help prioritize or triage this vulnerability.\n\n  Format the response as structured JSON with the following keys: `identifier`, `title`, `affected_service`, `slack_channel`, `owners`, `environments`, `dependencies`, and `notes`.",
            "labels": "{\n    \"source\": \"n8n-workflow\",\n    \"use_case\": \"vulnerability-context-enrichment\"\n  }",
            "model": "gpt-5"
          },
          "type": "CUSTOM.portIo",
          "typeVersion": 1,
          "position": [
            -624,
            96
          ],
          "id": "ad298688-35d1-4278-9e1d-fca3856eb02d",
          "name": "Get Context From Port",
          "credentials": {
            "portIoApi": {
              "id": "a9s5zHKi57ADlTON",
              "name": "Port.io account"
            }
          }
        },
        {
          "parameters": {
            "operation": "getInvocation",
            "invocationId": "={{ $json.invocationIdentifier }}"
          },
          "type": "CUSTOM.portIo",
          "typeVersion": 1,
          "position": [
            -352,
            96
          ],
          "id": "f80eed76-7b4d-4b1e-a69d-cad360241c13",
          "name": "Process Port AI Response",
          "credentials": {
            "portIoApi": {
              "id": "a9s5zHKi57ADlTON",
              "name": "Port.io account"
            }
          }
        }
      ],
      "pinData": {},
      "connections": {
        "Webhook Trigger": {
          "main": [
            [
              {
                "node": "Get Context From Port",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "OpenAI Remediation Plan": {
          "main": [
            [
              {
                "node": "Is Fixable?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Error Trigger": {
          "main": [
            [
              {
                "node": "Error Alert Slack",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Is Fixable?": {
          "main": [
            [
              {
                "node": "Trigger Claude Code",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Send Slack Message",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Trigger Claude Code": {
          "main": [
            [
              {
                "node": "Send Slack Message",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get Context From Port": {
          "main": [
            [
              {
                "node": "Process Port AI Response",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Process Port AI Response": {
          "main": [
            [
              {
                "node": "OpenAI Remediation Plan",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "active": false,
      "settings": {
        "executionOrder": "v1"
      },
      "versionId": "0d68ebcf-c7ab-489d-9713-9a23694454ac",
      "meta": {
        "templateCredsSetupCompleted": true,
        "instanceId": "e9a36cfd74df34fd103d5f6c7fed0e3d25bfc51a5d136cd0fb7eba9c77b96ae3"
      },
      "id": "eNhr3iawT6LAYacO",
      "tags": []
    }
    ```
    </details>

    :::tip Default value replacement
    Replace `<DEFAULT_SLACK_CHANNEL>` with the Slack channel where you want notifications sent if Port cannot find a specific channel for the vulnerability.

    Similarly, replace `<OWNER/REPO>` with your default infrastructure repository. This will be used if no repository or service is linked to the vulnerability in Port as part of the coding agent execution.
    :::

4. After importing, configure the following credentials in n8n:
   - **Port.io credentials** ‚Äî Use the Port.io credential you created during node installation (contains your Client ID and Client Secret)
   - **Slack credentials** ‚Äî Add your Slack API token
   - **OpenAI credentials** ‚Äî Add your OpenAI API key

### Configure the workflow

The workflow consists of several key nodes:

1. **Webhook Trigger** ‚Äî Receives vulnerability alerts from Snyk or other security scanners
2. **Get Context From Port** ‚Äî Uses Port's custom node to invoke the context retriever agent and retrieve service metadata
3. **Process Port AI Response** ‚Äî Uses Port's custom node to get the full AI response with context (handles async invocation automatically)
4. **OpenAI Remediation Plan** ‚Äî Generates a remediation plan using the enriched context from Port
5. **Is Fixable?** ‚Äî Routes to either automated fix or notification based on the remediation plan
6. **Trigger Claude Code** ‚Äî (Optional) Triggers automated code fix via Port action
7. **Send Slack Message** ‚Äî Sends notification to Slack with context
8. **Error Trigger** and **Error Alert Slack** ‚Äî Handle workflow errors gracefully


## Workflow patterns

The n8n workflow demonstrates two primary patterns for using Port as a context lake:

### Pattern 1: Targeted Slack notifications

When a vulnerability is detected, the workflow:

1. Receives the vulnerability alert via webhook
2. Queries Port's context retriever agent to get:
   - Affected services
   - Owning teams
   - Slack channel
   - Related environments
   - Dependencies
3. Sends a targeted Slack notification to the owning team with full context

This ensures security alerts reach the right people with all the information they need to prioritize and respond.

### Pattern 2: AI-powered remediation

For fixable vulnerabilities, the workflow:

1. Retrieves context from Port (same as Pattern 1)
2. Generates a remediation plan using OpenAI with the enriched context
3. Routes to Claude Code (or another coding agent) to automatically generate a fix
4. Opens a pull request with the fix

The Port context ensures the AI agent understands the service architecture, dependencies, and best practices before generating code.

## Test the workflow

### Test with a sample vulnerability

1. **Trigger the webhook** with a sample payload:

    ```json
    {
      "vulnerability_id": "CVE-2025-10023",
      "description": "Buffer overflow in crypto library 2.1.4",
      "severity": "high"
    }
    ```

2. **Verify Port context retrieval** ‚Äî Check that the "Get Context From Port" and "Process Port AI Response" nodes successfully retrieve:
   - Related services
   - Ownership information
   - Environment details
   - Dependencies

3. **Check Slack notification** ‚Äî Verify the notification includes:
   - Vulnerability details
   - Service context from Port
   - Remediation plan

      <img src='/img/guides/security-vuln-n8n-slack-notif.png' border="1px" width="100%" />


4. **Verify AI remediation** (if applicable) ‚Äî Confirm that fixable vulnerabilities trigger the coding agent with proper context

## Related resources

- [Remediate vulnerabilities with AI](/guides/all/remediate-vulnerability-with-ai) ‚Äî Use Port AI agents to automatically enrich and fix vulnerabilities
- [Trigger Claude Code from Port](/guides/all/trigger-claude-code-from-port) ‚Äî Set up Claude Code integration with Port
- [Set up the Task Manager AI agent](/guides/all/setup-task-manager-ai-agent) ‚Äî Create an AI agent to manage and prioritize development tasks

