---
sidebar_position: 3
---

import Tabs from "@theme/Tabs"
import TabItem from "@theme/TabItem"
import Prerequisites from "../templates/\_ocean_helm_prerequisites_block.mdx"

# FireHydrant

Our FireHydrant integration allows you to import `environment`, `service`, `incident` and `retrospective` from your FireHydrant account into Port, according to your mapping and definitions.

## Common use cases

- Map `environment`, `service`, `incident` and `retrospective` in your FireHydrant account.
- Watch for object changes (create/update/delete) in real-time, and automatically apply the changes to your entities in Port.

## Prerequisites

<Prerequisites />

## Installation

Install the integration via Helm by running this command:

```bash showLineNumbers
# The following script will install an Ocean integration in your K8s cluster using helm
# integration.identifier: Change the identifier to describe your integration
# integration.config.appHost: (Optional) The host of the Port Ocean app. Used to set up the integration endpoint as the target for Webhooks created in Firehydrant
# integration.config.apiUrl: The URL of your Firehydrant API, for example: https://api.firehydrant.io
# integration.secrets.token: Firehydrant API token generated by the user

helm upgrade --install my-firehydrant-integration port-labs/port-ocean \
	--set port.clientId="CLIENT_ID"  \
	--set port.clientSecret="CLIENT_SECRET"  \
	--set initializePortResources=true  \
	--set integration.identifier="my-firehydrant-integration"  \
	--set integration.type="firehydrant"  \
	--set integration.eventListener.type="POLLING"  \
	--set integration.config.apiUrl="https://api.firehydrant.io"  \
	--set integration.secrets.token="<FIREHYDRANT_API_TOKEN>"
```

## Ingesting FireHydrant objects

The FireHydrant integration uses a YAML configuration to describe the process of loading data into the developer portal. See [examples](#examples) below.

The integration makes use of the [JQ JSON processor](https://stedolan.github.io/jq/manual/) to select, modify, concatenate, transform and perform other operations on existing fields and values from FireHydrant's API events.

### Configuration structure

The integration configuration determines which resources will be queried from FireHydrant, and which entities and properties will be created in Port.

:::tip Supported resources
The following resources can be used to map data from FireHydrant, it is possible to reference any field that appears in the API responses linked below for the mapping configuration.

- [`Environment`](https://developers.firehydrant.com/#/operations/getV1Environments)
- [`Service`](https://developers.firehydrant.com/#/operations/getV1Services)
- [`Incident`](https://developers.firehydrant.com/#/operations/getV1Incidents)
- [`Retrospective`](https://developers.firehydrant.com/#/operations/getV1PostMortemsReports)

:::

- The root key of the integration configuration is the `resources` key:

  ```yaml showLineNumbers
  # highlight-next-line
  resources:
    - kind: service
      selector:
      ...
  ```

- The `kind` key is a specifier for a FireHydrant object:

  ```yaml showLineNumbers
    resources:
      # highlight-next-line
      - kind: service
        selector:
        ...
  ```

- The `selector` and the `query` keys allow you to filter which objects of the specified `kind` will be ingested into your software catalog:

  ```yaml showLineNumbers
  resources:
    - kind: service
      # highlight-start
      selector:
        query: "true" # JQ boolean expression. If evaluated to false - this object will be skipped.
      # highlight-end
      port:
  ```

- The `port`, `entity` and the `mappings` keys are used to map the FireHydrant object fields to Port entities. To create multiple mappings of the same kind, you can add another item in the `resources` array;

  ```yaml showLineNumbers
  resources:
    - kind: service
      selector:
        query: "true"
      port:
        # highlight-start
        entity:
          mappings: # Mappings between one FireHydrant object to a Port entity. Each value is a JQ query.
            identifier: .id
            title: .name
            blueprint: '"firehydrantService"'
            properties:
              description: .description
        # highlight-end
    - kind: service # In this instance service is mapped again with a different filter
      selector:
        query: '.name == "MyServiceName"'
      port:
        entity:
          mappings: ...
  ```

  :::tip Blueprint key
  Note the value of the `blueprint` key - if you want to use a hardcoded string, you need to encapsulate it in 2 sets of quotes, for example use a pair of single-quotes (`'`) and then another pair of double-quotes (`"`)
  :::

### Ingest data into Port

To ingest FireHydrant objects using the [integration configuration](#configuration-structure), you can follow the steps below:

1. Go to the DevPortal Builder page.
2. Select a blueprint you want to ingest using FireHydrant.
3. Choose the **Ingest Data** option from the menu.
4. Select FireHydrant under the Incident management category.
5. Modify the [configuration](#configuration-structure) according to your needs.
6. Click `Resync`.

## Examples

Examples of blueprints and the relevant integration configurations:

### Environment

<details>
<summary>Environment blueprint</summary>

```json showLineNumbers
{
  "identifier": "firehydrantEnvironment",
  "description": "This blueprint represents a firehydrant environment",
  "title": "FireHydrant Environment",
  "icon": "FireHydrant",
  "schema": {
    "properties": {
      "description": {
        "title": "Description",
        "type": "string"
      },
      "activeIncidents": {
        "title": "Active Incidents",
        "type": "number",
        "description": "Number of active incidents attached to this environment"
      },
      "createdAt": {
        "title": "Created At",
        "type": "string",
        "format": "date-time"
      },
      "updatedAt": {
        "title": "Updated At",
        "type": "string",
        "format": "date-time"
      }
    },
    "required": []
  },
  "mirrorProperties": {},
  "calculationProperties": {},
  "relations": {}
}
```

</details>

<details>
<summary>Integration configuration</summary>

```yaml showLineNumbers
resources:
  - kind: environment
    selector:
      query: "true"
    port:
      entity:
        mappings:
          blueprint: '"firehydrantEnvironment"'
          identifier: .id
          title: .name
          properties:
            description: .description
            activeIncidents: .active_incidents | length
            createdAt: .created_at
            updatedAt: .updated_at
```

</details>

### Service

<details>
<summary>Service blueprint</summary>

```json showLineNumbers
{
  "identifier": "firehydrantService",
  "description": "This blueprint represents a firehydrant service",
  "title": "FireHydrant Service",
  "icon": "FireHydrant",
  "schema": {
    "properties": {
      "description": {
        "title": "Description",
        "type": "string",
        "icon": "DefaultProperty"
      },
      "slug": {
        "title": "Slug",
        "type": "string",
        "icon": "DefaultProperty"
      },
      "links": {
        "title": "Links",
        "type": "array",
        "icon": "DefaultProperty"
      },
      "labels": {
        "icon": "DefaultProperty",
        "title": "Labels",
        "type": "object"
      },
      "owner": {
        "title": "Team",
        "type": "string",
        "icon": "DefaultProperty"
      },
      "createdAt": {
        "title": "Created At",
        "type": "string",
        "format": "date-time",
        "icon": "DefaultProperty"
      },
      "updatedAt": {
        "title": "Updated At",
        "type": "string",
        "format": "date-time",
        "icon": "DefaultProperty"
      },
      "activeIncidents": {
        "title": "Active Incidents",
        "type": "number",
        "description": "Number of active incidents attached to this service"
      },
      "meanTimeToAcknowledge": {
        "title": "Mean Time to Acknowledge",
        "type": "number",
        "description": "Mean time (in hours) to acknowledge incidents attached to this service"
      },
      "meanTimeToDetect": {
        "title": "Mean Time to Detection",
        "type": "number",
        "description": "Mean time (in hours) to detect incidents attached to this service"
      },
      "meanTimeToMitigate": {
        "title": "Mean Time to Mitigation",
        "type": "number",
        "description": "Mean time (in hours) to mitigate incidents attached to this service"
      },
      "meanTimeToResolve": {
        "title": "Mean Time to Resolution",
        "type": "number",
        "description": "Mean time (in hours) to resolve incidents attached to this service"
      }
    },
    "required": []
  },
  "mirrorProperties": {},
  "calculationProperties": {},
  "relations": {}
}
```

</details>

<details>
<summary>Integration configuration</summary>

```yaml showLineNumbers
resources:
  - kind: service
    selector:
      query: "true"
    port:
      entity:
        mappings:
          blueprint: '"firehydrantService"'
          identifier: .id
          title: .name
          properties:
            description: .description
            slug: .slug
            links: .links[].href_url
            labels: .labels
            owner: .owner.name
            activeIncidents: .active_incidents | length
            meanTimeToAcknowledge: '[(.__incidents.milestones[] | map(select(.type == "started" or .type == "acknowledged")) | sort_by(.occurred_at) | group_by(.type) | map(.[0].occurred_at) | select(length == 2) | ([.[1], .[0]] | map(sub("\\.\\d+Z$"; "Z") | fromdate)) | .[1] - .[0] // null)] | add / length / 3600 | floor'
            meanTimeToDetect: '[(.__incidents.milestones[] | map(select(.type == "started" or .type == "detected")) | sort_by(.occurred_at) | group_by(.type) | map(.[0].occurred_at) | select(length == 2) | ([.[1], .[0]] | map(sub("\\.\\d+Z$"; "Z") | fromdate)) | .[1] - .[0] // null)] | add / length / 3600 | floor'
            meanTimeToMitigate: '[(.__incidents.milestones[] | map(select(.type == "started" or .type == "mitigated")) | sort_by(.occurred_at) | group_by(.type) | map(.[0].occurred_at) | select(length == 2) | ([.[1], .[0]] | map(sub("\\.\\d+Z$"; "Z") | fromdate)) | .[1] - .[0] // null)] | add / length / 3600 | floor'
            meanTimeToResolve: '[(.__incidents.milestones[] | map(select(.type == "started" or .type == "resolved")) | sort_by(.occurred_at) | group_by(.type) | map(.[0].occurred_at) | select(length == 2) | ([.[1], .[0]] | map(sub("\\.\\d+Z$"; "Z") | fromdate)) | .[1] - .[0] // null)] | add / length / 3600 | floor'
            createdAt: .created_at
            updatedAt: .updated_at
```

</details>

### Incident

<details>
<summary>Incident blueprint</summary>

```json showLineNumbers
{
  "identifier": "firehydrantIncident",
  "description": "This blueprint represents a firehydrant incident",
  "title": "FireHydrant Incident",
  "icon": "FireHydrant",
  "schema": {
    "properties": {
      "url": {
        "type": "string",
        "title": "Incident URL",
        "format": "url",
        "description": "the link to the incident"
      },
      "priority": {
        "title": "Priority",
        "type": "string",
        "enum": ["P1", "P2", "P3", "P4"],
        "enumColors": {
          "P1": "red",
          "P2": "red",
          "P3": "orange",
          "P4": "orange"
        }
      },
      "severity": {
        "title": "Severity",
        "type": "string"
      },
      "tags": {
        "title": "Tags",
        "type": "array"
      },
      "currentMilestone": {
        "type": "string",
        "title": "Current Milestone",
        "default": "started",
        "enum": [
          "started",
          "detected",
          "acknowledged",
          "investigating",
          "identified",
          "mitigated",
          "resolved",
          "postmortem_started",
          "postmortem_completed",
          "closed"
        ],
        "enumColors": {
          "started": "red",
          "detected": "red",
          "acknowledged": "orange",
          "investigating": "yellow",
          "identified": "yellow",
          "mitigated": "green",
          "resolved": "green",
          "postmortem_started": "purple",
          "postmortem_completed": "blue",
          "closed": "green"
        }
      },
      "functionalities": {
        "title": "Functionalities Impacted",
        "type": "array"
      },
      "customerImpact": {
        "title": "Customers Impacted",
        "type": "string"
      },
      "createdBy": {
        "title": "Created By",
        "type": "string",
        "format": "user",
        "icon": "TwoUsers"
      },
      "createdAt": {
        "title": "Created At",
        "type": "string",
        "format": "date-time"
      },
      "description": {
        "title": "Description",
        "type": "string"
      },
      "commander": {
        "title": "Commander",
        "type": "string",
        "format": "user",
        "icon": "TwoUsers"
      }
    },
    "required": []
  },
  "mirrorProperties": {},
  "calculationProperties": {},
  "relations": {
    "environment": {
      "title": "Impacted Environments",
      "target": "firehydrantEnvironment",
      "required": false,
      "many": true
    },
    "service": {
      "title": "Impacted Services",
      "target": "firehydrantService",
      "required": false,
      "many": true
    }
  }
}
```

</details>

<details>
<summary>Integration configuration</summary>

```yaml showLineNumbers
resources:
  - kind: incident
    selector:
      query: "true"
    port:
      entity:
        mappings:
          blueprint: '"firehydrantIncident"'
          identifier: .id
          title: .name
          properties:
            url: .incident_url
            priority: .priority
            severity: .severity
            tags: .tag_list
            currentMilestone: .current_milestone
            functionalities: .functionalities[].name
            description: .description
            customerImpact: .customers_impacted
            commander: .role_assignments[] | select(.incident_role.name == "Commander") | .user.email
            createdBy: .created_by.email
            createdAt: .created_at
          relations:
            environment: .environments | map(.id)
            service: .services | map(.id)
```

</details>

### Retrospective

<details>
<summary>Retrospective blueprint</summary>

```json showLineNumbers
{
  "identifier": "firehydrantRetrospective",
  "description": "This blueprint represents a service in our software catalog",
  "title": "FireHydrant Retrospective",
  "icon": "FireHydrant",
  "schema": {
    "properties": {
      "url": {
        "type": "string",
        "title": "Incident URL",
        "format": "url",
        "description": "the link to the incident",
        "icon": "DefaultProperty"
      },
      "tags": {
        "title": "Tags",
        "type": "array",
        "icon": "DefaultProperty"
      },
      "services": {
        "title": "Services Impacted",
        "type": "array",
        "icon": "DefaultProperty"
      },
      "environments": {
        "title": "Environments Impacted",
        "type": "array",
        "icon": "DefaultProperty"
      },
      "functionalities": {
        "title": "Functionalities Impacted",
        "type": "array",
        "icon": "DefaultProperty"
      },
      "createdBy": {
        "title": "Created By",
        "type": "string",
        "format": "user",
        "icon": "TwoUsers"
      },
      "createdAt": {
        "title": "Created At",
        "type": "string",
        "format": "date-time",
        "icon": "DefaultProperty"
      },
      "customerImpact": {
        "title": "Customer Impact",
        "type": "string",
        "icon": "DefaultProperty"
      },
      "commander": {
        "title": "Commander",
        "type": "string",
        "format": "user",
        "icon": "TwoUsers"
      },
      "resolvedAt": {
        "title": "Resolved At",
        "type": "string",
        "format": "date-time",
        "icon": "DefaultProperty"
      },
      "publishedAt": {
        "title": "Published At",
        "type": "string",
        "format": "date-time",
        "icon": "DefaultProperty"
      },
      "duration": {
        "icon": "DefaultProperty",
        "title": "Incident Duration (Hours)",
        "type": "number"
      },
      "completedTasks": {
        "icon": "DefaultProperty",
        "title": "Tasks Completed",
        "type": "number"
      },
      "incompletedTasks": {
        "icon": "DefaultProperty",
        "title": "Tasks Not Completed",
        "type": "number"
      },
      "questions": {
        "title": "Retro Questions and Answers",
        "type": "array",
        "icon": "DefaultProperty"
      }
    },
    "required": []
  },
  "mirrorProperties": {},
  "calculationProperties": {},
  "relations": {
    "incident": {
      "title": "Incident",
      "target": "firehydrantIncident",
      "required": false,
      "many": false
    }
  }
}
```

</details>

<details>
<summary>Integration configuration</summary>

```yaml showLineNumbers
resources:
  - kind: retrospective
    selector:
      query: '.incident.current_milestone == "postmortem_completed"'
    port:
      entity:
        mappings:
          blueprint: '"firehydrantRetrospective"'
          identifier: .id
          title: .name
          properties:
            url: .incident.incident_url
            tags: .tag_list
            services: .incident.services[].name
            environments: .incident.environments[].name
            functionalities: .incident.functionalities[].name
            description: .incident.description
            customerImpact: .incident.customers_impacted
            commander: .incident.role_assignments[] | select(.incident_role.name == "Commander") | .user.email
            createdBy: .incident.created_by.email
            resolvedAt: .incident.milestones[] | select(.type == "resolved") | .created_at
            createdAt: .incident.created_at
            publishedAt: .incident.milestones[] | select(.type == "postmortem_completed") | .created_at
            duration: (.incident.milestones | map(select(.type == "started" or .type == "resolved")) | sort_by(.occurred_at) | group_by(.type) | map(.[0].occurred_at) | select(length == 2) | ([.[1], .[0]] | map(sub("\\.\\d+Z$"; "Z") | fromdate)) | .[1] - .[0] // null) | ./3600 | floor
            completedTasks: .__incident.tasks | map(select(.state == "done")) | length
            incompletedTasks: .__incident.tasks | map(select(.state != "done")) | length
            questions: ".questions | map({question: .title, answer: .body})"
          relations:
            incident: .incident.id
```

</details>
