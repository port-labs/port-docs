---
sidebar_position: 1
---

import InstallTerraform from "./\_terraform_provider_base.mdx"

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";

# Terraform

Our integration with [Terraform](https://www.terraform.io/) allows you to combine the state of your infrastructure with the entities representing them in Port.

By using Port's Terraform provider you make it easy to integrate Port with your existing IaC definitions, every resource provisioned by Terraform can also be reported to the software catalog using the same `.tf` definition file.

:::info port terraform provider
You can view the official registry page for our Terraform provider [here](https://registry.terraform.io/providers/port-labs/port-labs/)
:::

## ðŸ’¡ Terraform provider common use cases

Our Terraform provider makes it easy to fill the software catalog with data directly from your IaC definitions, for example:

- Report **cloud accounts**;
- Report **databases**;
- Report **lambdas** and **managed Kubernetes services** (EKS, AKS, GKE, etc.);
- etc.

## Installation

<InstallTerraform/>

## Terraform definition structure

Port's Terraform provider supports The following resources to ingest data to the catalog:

### `port-labs_entity`

The [`port-labs_entity`](https://registry.terraform.io/providers/port-labs/port-labs/latest/docs/resources/entity) resource defines a basic entity:

```hcl showLineNumbers
# highlight-start
resource "port-labs_entity" "myEntity" {
  identifier = "myEntity" # Entity identifier
  title      = "My Entity" # Entity title
  blueprint  = "myBlueprint" # Identifier of the blueprint to create this entity from
 # highlight-end

  # Entity property values
  properties {
    ...
  }
  ...
  # Entity relations
  ...
}
```

The following parameters are **required**:

- `blueprint` - the identifier of the blueprint to create this entity from;
- `title` - the title of the entity;
- One or more [`properties`](#properties-schema) schema definitions.

It is also possible to specify the following parameters as part of the `port-labs_entity` resource:

- `identifier` - the identifier of the entity;
  - If an `identifier` is not provided, an identifier will be autogenerated.
- `team` - the team that owns the entity;
- `teams` - an array of teams that own the entity;
- `run_id` - the run ID of the action that created the entity.

### `properties` schema

The [`properties`](https://registry.terraform.io/providers/port-labs/port-labs/latest/docs/resources/entity#nested-schema-for-properties) schema assigns a specified value to one of the entity's properties.

```hcl showLineNumbers
resource "port-labs_entity" "myEntity" {
  identifier = "myEntity" # Entity identifier
  title      = "My Entity" # Entity title
  blueprint  = "myBlueprint" # Identifier of the blueprint to create this entity from

# highlight-start
  properties {
    name  = "myStringProp"
    value = "My string"
  }

  properties {
    name  = "myNumberProp"
    value = 7
  }

  properties {
    name  = "myArrayProp"
    items = [1,2,3]
  }
 # highlight-end

  # Entity relations
  ...
}
```

#### Definition

<Tabs groupId="properties" queryString="property" defaultValue="string" values={[
{label: "String", value: "string"},
{label: "Number", value: "number"},
{label: "Boolean", value: "boolean"},
{label: "Object", value: "object"},
{label: "Array", value: "array"},
{label: "URL", value: "url"},
{label: "Email", value: "email"},
{label: "User", value: "user"},
{label: "Team", value: "team"},
{label: "Datetime", value: "datetime"},
{label: "Timer", value: "timer"},
{label: "YAML", value: "yaml"}
]}>

<TabItem value="string">

```hcl showLineNumbers
properties {
  name = "myStringProp"
  value = "My string"
}
```

</TabItem>
<TabItem value="number">

```hcl showLineNumbers
properties {
  name = "myNumberProp"
  value = 7
}
```

</TabItem>
<TabItem value="boolean">

```hcl showLineNumbers
properties {
  name = "myBooleanProp"
  value = true
}
```

</TabItem>
<TabItem value="object">

```hcl showLineNumbers
properties {
  name = "myObjectProp"
  value = jsonencode({ "my" : "object" })
}
```

</TabItem>
<TabItem value="array">

```hcl showLineNumbers
properties {
  name = "myArrayProp"
  items = [1, 2, 3]
}
```

</TabItem>
<TabItem value="url">

```hcl showLineNumbers
properties {
  name = "myUrlProp"
  value = "https://example.com"
}
```

</TabItem>
<TabItem value="email">

```hcl showLineNumbers
properties {
  name = "myEmailProp"
  value = "me@example.com"
}
```

</TabItem>
<TabItem value="user">

```hcl showLineNumbers
properties {
  name = "myUserProp"
  value = "user@example.com"
}
```

</TabItem>
<TabItem value="team">

```hcl showLineNumbers
properties {
  name = "myTeamProp"
  value = "argo-admins"
}
```

</TabItem>
<TabItem value="datetime">

```hcl showLineNumbers
properties {
  name = "myDatetimeProp"
  value = "2022-04-18T11:44:15.345Z"
}
```

</TabItem>
<TabItem value="timer">

```hcl showLineNumbers
properties {
  name = "myTimerProp"
  value = "2023-04-18T11:44:15.345Z"
}
```

</TabItem>
<TabItem value="yaml">

```hcl showLineNumbers
properties {
  name = "myYAMLProp"
  value = "my: yaml"
}
```

</TabItem>

</Tabs>

The following parameters are **required**:

- `name` - the name of the property in the [blueprint definition](../../../define-your-data-model/setup-blueprint/properties/properties.md#structure);
- `value` - the value of the property (for non-array properties);
- `items` - an array of values (for array properties).

### `relations` schema

The [`relations`](https://registry.terraform.io/providers/port-labs/port-labs/latest/docs/resources/entity#relations) schema maps a target entity to the source entity definition:

```hcl showLineNumbers
resource "port-labs_entity" "myEntity" {
  identifier = "myEntity" # Entity identifier
  title      = "My Entity" # Entity title
  blueprint  = "myBlueprint" # Identifier of the blueprint to create this entity from

  # Entity properties
  ...

# highlight-start
  relations {
    name  = "myRelation"
    identifier = "myTargetEntityIdentifier"
  }

  relations {
    name  = "myAdditionalRelation"
    identifier = "myAdditionalTargetEntityIdentifier"
  }
 # highlight-end
}
```

The following parameters are **required**:

- `name` - the name of the [relation](../../../define-your-data-model/relate-blueprints/relate-blueprints.md#structure-table) in the blueprint definition;
- `identifier` - the identifier of the target entity.

:::note
At the moment, it is only possible to create entities with `many: false` relations using Port's Terraform provider.
:::

## Ingest data using the Terraform provider

To ingest data to the software catalog using the Terraform provider, you will define [`port-labs_entity`](https://registry.terraform.io/providers/port-labs/port-labs/latest/docs/resources/entity) resources in your Terraform definition files:

<Tabs groupId="sync-data" queryString="current-scenario" defaultValue="create" values={[
{label: "Create", value: "create"},
{label: "Update", value: "update"},
{label: "Delete", value: "delete"},
]} >

<TabItem value="create">

To create an entity using Terraform, add a `port-labs_entity` resource to your `.tf` definition file:

```hcl showLineNumbers
resource "port-labs_entity" "myEntity" {
  identifier = "myEntity"
  title      = "My Entity"
  blueprint  = "myBlueprint"

  properties {
    name  = "myStringProp"
    value = "Example microservice"
  }
  properties {
    name  = "myNumberProp"
    value = 1
  }
  properties {
    name  = "myArrayProp"
    items = ["#rnd", "#deployments"]
  }
  properties {
    name  = "myObjectProp"
    value = jsonencode({ "foo" : "bar" })
  }
  properties {
    name  = "myBoolProp"
    value = true
  }
}
```

Then run the following commands to apply your changes and update the catalog:

```shell showLineNumbers
# To view Terraform's planned changes based on your .tf definition file:
terraform plan
# To apply the changes and update the catalog
terraform apply
```

After running these commands, you will see your catalog updated with the new entities.

</TabItem>

<TabItem value="update">

To update an entity using Terraform, update the existing `port-labs_entity` resource in your `.tf` definition file and then run `terraform apply`.

It is also possible to start managing existing entities using Port's Terraform provider, to begin managing an existing entity, add a new `port-labs_entity` resource to your `.tf` definition file and make the desired changes:

```hcl showLineNumbers
resource "port-labs_entity" "myExistingEntity" {
  # highlight-next-line
  identifier = "myExistingEntity"
  title      = "My Entity"
  blueprint  = "myBlueprint"

  # Entity properties and relations
  ...
}
```

:::info
Important notes about adding existing entities to the Terraform provider:

- It is important to specify the `identifier` of the entity, otherwise terraform will create a new entity with an autogenerated identifier.
- Port's Terraform provider uses the [create/override](../../api/api.md?update-strategy=create-override#usage) strategy, meaning for an existing entity, any properties not defined in the resource definition will be overridden with empty values.

:::

</TabItem>

<TabItem value="delete">

To delete an entity using Terraform, simply remove the `port-labs_entity` resource defined in your `.tf` definition file and then run `terraform apply`.

</TabItem>

</Tabs>

## Examples

Refer to the [examples](./examples/examples.md) page for practical configurations and their corresponding blueprint definitions.
