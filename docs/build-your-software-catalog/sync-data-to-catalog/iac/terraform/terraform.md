---
sidebar_position: 1
---

import InstallTerraform from "./\_terraform_provider_base.mdx"

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";

# Terraform

Our integration with [Terraform](https://www.terraform.io/) allows you to combine the state of your infrastructure with the entities representing them in Port.

By using Port's Terraform provider you make it easy to integrate Port with your existing IaC definitions, every resource provisioned by Terraform can also be reported to the software catalog using the same `.tf` definition file.

:::info port terraform provider
You can view the official registry page for our Terraform provider [here](https://registry.terraform.io/providers/port-labs/port-labs/)
:::

## ðŸ’¡ Terraform provider common use cases

Our Terraform provider makes it easy to fill the software catalog with data directly from your IaC definitions, for example:

- Report **cloud accounts**;
- Report **databases**;
- Report **lambdas** and **managed Kubernetes services** (EKS, AKS, GKE, etc.);
- etc.

## Installation

<InstallTerraform/>

## Terraform definition structure

Port's Terraform provider supports The following resources to ingest data to the catalog:

### `port_entity`

The [`port_entity`](https://registry.terraform.io/providers/port-labs/port-labs/latest/docs/resources/port_entity) resource defines a basic entity:

```hcl showLineNumbers
# highlight-start
resource "port_entity" "myEntity" {
  identifier = "myEntity" # Entity identifier
  title      = "My Entity" # Entity title
  blueprint  = "myBlueprint" # Identifier of the blueprint to create this entity from
 # highlight-end

  # Entity property values
  properties = {
    ...
  }
  ...
  # Entity relations
  ...
}
```

The following parameters are **required**:

- `blueprint` - the identifier of the blueprint to create this entity from;
- `title` - the title of the entity;
- One or more [`properties`](#properties-schema) schema definitions.

It is also possible to specify the following parameters as part of the `port_entity` resource:

- `identifier` - the identifier of the entity;
  - If an `identifier` is not provided, an identifier will be autogenerated.
- `teams` - an array of teams that own the entity;
- `run_id` - the run ID of the action that created the entity.

### `properties` schema

The [`properties`](https://registry.terraform.io/providers/port-labs/port-labs/latest/docs/resources/port_entity#nested-schema-for-properties) schema assigns a specified value to one of the entity's properties.

```hcl showLineNumbers
resource "port_entity" "myEntity" {
  identifier = "myEntity" # Entity identifier
  title      = "My Entity" # Entity title
  blueprint  = "myBlueprint" # Identifier of the blueprint to create this entity from

# highlight-start
  properties = {
    string_props = {
      "myStringProp" = "My string"
      }

    number_props = {
      "myNumberProp" = 7
      }

    array_props = {
      string_items = {
        "myArrayProp" = ["a", "b", "c"]
        }
      }
 # highlight-end
  }
  # Entity relations
  ...
}
```

#### Definition

<Tabs groupId="properties" queryString="property" defaultValue="string" values={[
{label: "String", value: "string"},
{label: "Number", value: "number"},
{label: "Boolean", value: "boolean"},
{label: "Object", value: "object"},
{label: "Array", value: "array"},
{label: "URL", value: "url"},
{label: "Email", value: "email"},
{label: "User", value: "user"},
{label: "Team", value: "team"},
{label: "Datetime", value: "datetime"},
{label: "Timer", value: "timer"},
{label: "YAML", value: "yaml"}
]}>

<TabItem value="string">

```hcl showLineNumbers
properties = {
  string_props = {
   "myStringProp" = "My string"
  }
}
```

</TabItem>
<TabItem value="number">

```hcl showLineNumbers
properties = {
  number_props = {
    "myNumberProp" = 7
  }
}
```

</TabItem>
<TabItem value="boolean">

```hcl showLineNumbers
properties = {
  boolean_props = {
    "myBooleanProp" = true
  }
}
```

</TabItem>
<TabItem value="object">

```hcl showLineNumbers
properties = {
  object_props = {
    "myObjectProp" = jsonencode({ "my" : "object" })
  }
}
```

</TabItem>
<TabItem value="array">

```hcl showLineNumbers
properties = {
  array_props = {
    string_props = {
      "myArrayProp" = ["a", "b", "c"])
    }
  }
}
```

</TabItem>
<TabItem value="url">

```hcl showLineNumbers
properties = {
  string_props = {
    "myUrlProp" = "https://example.com"
  }
}
```

</TabItem>
<TabItem value="email">

```hcl showLineNumbers
properties = {
  string_props = {
    "myEmailProp" = "me@example.com"
  }
}

```

</TabItem>
<TabItem value="user">

```hcl showLineNumbers
properties = {
 string_props = {
   "myUserProp" = "argo-admin"
  }
}
```

</TabItem>
<TabItem value="team">

```hcl showLineNumbers
properties = {
  string_props = {
    "myTeamProp" = "argo-admins"
  }
}
```

</TabItem>
<TabItem value="datetime">

```hcl showLineNumbers
properties = {
  string_props = {
    "myDatetimeProp" = "2023-04-18T11:44:15.345Z"
  }
}
```

</TabItem>
<TabItem value="timer">

```hcl showLineNumbers
properties = {
  string_props = {
    "myUserProp" = "argo-admin"
  }
}

```

</TabItem>
<TabItem value="yaml">

```hcl showLineNumbers
properties = {
  string_props = {
    "myYamlProp" = "myKey: myValue"
  }
}
```

</TabItem>

</Tabs>

### `relations` schema

The [`relations`](https://registry.terraform.io/providers/port-labs/port-labs/latest/docs/resources/port_entity#relations) schema maps a target entity to the source entity definition:

```hcl showLineNumbers
resource "port_entity" "myEntity" {
  identifier = "myEntity" # Entity identifier
  title      = "My Entity" # Entity title
  blueprint  = "myBlueprint" # Identifier of the blueprint to create this entity from

  # Entity properties
  ...

# highlight-start
  relations = {
    single_relations = {
    "mySingleRelation" = "myTargetEntityIdentifier"
    }
  }

  relations = {
    many_relations = {
      "myManyRelation" = ["myTargetEntityIdentifier", "myTargetEntityIdentifier2"]
    }
  }
 # highlight-end
}
```

#### Definition

<Tabs groupId="relations" queryString="relations" defaultValue="single" values={[
{label: "Single", value: "single"},
{label: "Many", value: "many"},
]} >

<TabItem value="single">

the schema is as follows:

```hcl showLineNumbers
relations {
  single_relations = {
    # Key-value pair of the relation identifier and the target identifier
    "mySingleRelation" = "myTargetEntityIdentifier"
  }
}
```

</TabItem>

<TabItem value="many">

the schema is as follows:

```hcl showLineNumbers
relations {
  many_relations = {
    # Key-value pair of the relation identifier and the target identifiers
    "myManyRelation" = ["myTargetEntityIdentifier", "myTargetEntityIdentifier2"]
  }
}
```

</TabItem>

</Tabs>

## Ingest data using the Terraform provider

To ingest data to the software catalog using the Terraform provider, you will define [`port_entity`](https://registry.terraform.io/providers/port-labs/port-labs/latest/docs/resources/port_entity) resources in your Terraform definition files:

<Tabs groupId="sync-data" queryString="current-scenario" defaultValue="create" values={[
{label: "Create", value: "create"},
{label: "Update", value: "update"},
{label: "Delete", value: "delete"},
]} >

<TabItem value="create">

To create an entity using Terraform, add a `port_entity` resource to your `.tf` definition file:

```hcl showLineNumbers
resource "port_entity" "myEntity" {
  identifier = "myEntity"
  title      = "My Entity"
  blueprint  = "myBlueprint"

  properties = {
    "string_props" = {
      "myStringProp" = "My string"
    }
    "number_props" = {
      "myNumberProp" = 7
    }
    "boolean_props" = {
      "myBooleanProp" = true
    }
    "object_props" = {
      "myObjectProp" = jsonencode({ "my" : "object" })
    }
    "array_props" = {
    "string_props" = {
        "myArrayProp" = ["a", "b", "c"]
      }
    }
  }
}
```

Then run the following commands to apply your changes and update the catalog:

```shell showLineNumbers
# To view Terraform's planned changes based on your .tf definition file:
terraform plan
# To apply the changes and update the catalog
terraform apply
```

After running these commands, you will see your catalog updated with the new entities.

</TabItem>

<TabItem value="update">

To update an entity using Terraform, update the existing `port_entity` resource in your `.tf` definition file and then run `terraform apply`.

It is also possible to start managing existing entities using Port's Terraform provider, to begin managing an existing entity, add a new `port_entity` resource to your `.tf` definition file and make the desired changes:

```hcl showLineNumbers
resource "port_entity" "myExistingEntity" {
  # highlight-next-line
  identifier = "myExistingEntity"
  title      = "My Entity"
  blueprint  = "myBlueprint"

  # Entity properties and relations
  ...
}
```

:::info
Important notes about adding existing entities to the Terraform provider:

- It is important to specify the `identifier` of the entity, otherwise terraform will create a new entity with an autogenerated identifier.
- Port's Terraform provider uses the [create/override](/build-your-software-catalog/custom-integration/api?update-strategy=create-override#usage) strategy, meaning for an existing entity, any properties not defined in the resource definition will be overridden with empty values.

:::

</TabItem>

<TabItem value="delete">

To delete an entity using Terraform, simply remove the `port_entity` resource defined in your `.tf` definition file and then run `terraform apply`.

</TabItem>

</Tabs>

## Import existing data to the Terraform state

<Tabs groupId="terraform-import" queryString="current-scenario" defaultValue="entity" values={[
{label: "Blueprint", value: "blueprint"},
{label: "Entity", value: "entity"},
]} >

<TabItem value="blueprint">

To import an existing blueprint to the Terraform state, add a `port_blueprint` resource to your `.tf` definition file:

```hcl showLineNumbers

# highlight-start

resource "port_blueprint" "myBlueprint" {
  ...
}

# highlight-end
```

Then run the following command to import the blueprint to the Terraform state:

```shell showLineNumbers
terraform import port_blueprint.myBlueprint "{blueprintIdentifier}"
```

</TabItem>

<TabItem value="entity">

To import an existing entity to the Terraform state, add a `port_entity` resource to your `.tf` definition file:

```hcl showLineNumbers

# highlight-start

resource "port_entity" "myEntity" {
  ...
}


# highlight-end
```

Then run the following command to import the entity to the Terraform state:

```shell showLineNumbers

terraform import port_entity.myEntity "{blueprintIdentifier}:{entityIdentifier}"
```

</TabItem>

</Tabs>

:::danger Applying after import
Before using `terraform import` to bring data from your Port account into your Terraform state file, make sure your resource definitions match the schema of your resources in Port. If they don't, your state will be deleted in the next `terraform apply`, since Terraform will try to apply the empty resources and override the imported state, while also updating Port in the process.                                                                                                                                          
:::

## Examples

Refer to the [examples](./examples/examples.md) page for practical configurations and their corresponding blueprint definitions.
