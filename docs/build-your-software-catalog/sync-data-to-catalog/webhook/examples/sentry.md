---
sidebar_position: 5
description: Ingest Sentry Issues into your catalog
---

import SentryCommentsBlueprint from "./resources/sentry/\_example_sentry_comments_blueprint.mdx";
import SentryCommentsConfiguration from "./resources/sentry/\_example_sentry_comment_webhook_configuration.mdx"
import SentryIssuesBluePrint from "./resources/sentry/\_example_sentry_issue_event_blueprint.mdx"
import SentryIssuesConfiguration from "./resources/sentry/\_example_sentry_issue_event_webhook_configuration.mdx"

# Sentry

In this example you are going to create a webhook integration between [Sentry](https://sentry.io) and Port, which will ingest issues entities.

## Port configuration

Create the following blueprint definition:

<details>

<summary>Sentry issue blueprint</summary>
<SentryIssuesBluePrint/>

</details>

Create the following webhook configuration [using Port UI](../../?operation=ui#configuring-webhook-endpoints):

<details>

<summary>Sentry issue webhook configuration</summary>

1. **Basic details** tab - fill the following details:
   1. Title : `Sentry issue mapper`;
   2. Identifier : `sentry_issue_mapper`;
   3. Description : `A webhook configuration to map Sentry Issues to Port`;
   4. Icon : `Sentry`;
2. **Integration configuration** tab - fill the following JQ mapping:

   <SentryIssuesConfiguration/>

3. Scroll down to **Advanced settings** and input the following details:
   1. Signature Header Name : `sentry-hook-signature`;
   2. Signature Algorithm : Select `sha256` from dropdown option;
   3. Click **Save** at the bottom of the page.

</details>

:::tip
We have left out the `secret` field from the security object in the webhook configuration because the secret value is generated by Sentry when creating the webhook.
So when following this example, please first create the webhook configuration in Port. Use the webhook URL from the response and create the webhook in Sentry.
After getting the secret from Sentry, you can go back to Port and update the [webhook configuration](../webhook.md#configuring-webhook-endpoints) with the secret.
:::

## Create a webhook in Sentry

1. Log in to Sentry with your organization's credentials;
2. Click the gear icon (Setting) at the left sidebar of the page;
3. Choose **Developer Settings**;
4. At the upper corner of this page, click on **Create New Integration**;
5. Sentry provides two types of integrations: Internal and Public. For the purpose of this guide, choose **Internal Integration** and click on the **Next** button;
6. Input the following details:
   1. `Name` - use a meaningful name such as Port Webhook;
   2. `Webhook URL` - enter the value of the `url` key you received after creating the webhook configuration;
   3. `Overview` - enter a description for the webhook;
   4. `Permissions` - Grant your webhook **Read** permissions for the **Issue & Event** category;
   5. `Webhooks` - Under this section, enable the issues checkbox to allow Sentry to report issue events to Port;
7. Click **Save Changes** at the bottom of the page.

:::tip
Now that the webhook is created, you can take the secret value generated by Sentry and use it to update the `security` object in your Port webhook configuration
:::

## Relate comments to Issues

The following example adds a `sentryComment` blueprint, in addition to the `sentryIssue` blueprint shown in the previous example. In addition, it also adds a `sentryIssue` relation. The webhook will create or update the relation between the 2 existing entities, allowing you to map which issue a comment is made on:

<details>

<summary>Sentry comments blueprint (including the sentryIssue relation)</summary>
<SentryCommentsBlueprint/>

</details>

Create the following webhook configuration [using Port UI](../../?operation=ui#configuring-webhook-endpoints):

<details>

<summary>Sentry comments webhook configuration</summary>

1. **Basic details** tab - fill the following details:
   1. Title : `Sentry comment mapper`;
   2. Identifier : `sentry_comment_mapper`;
   3. Description : `A webhook configuration to map Sentry Comments to Port`;
   4. Icon : `Sentry`;
2. **Integration configuration** tab - fill the following JQ mapping:

   <SentryCommentsConfiguration/>

3. Scroll down to **Advanced settings** and input the following details:
   1. Signature Header Name : `sentry-hook-signature`;
   2. Signature Algorithm : Select `sha256` from dropdown option;
   3. Click **Save** at the bottom of the page.

</details>

:::tip
In order to view the different payloads and events available in Sentry webhooks, [click here](https://docs.sentry.io/product/integrations/integration-platform/webhooks/)
:::

Done! any issue and comment in Sentry will trigger a webhook event. Port will parse the events according to the mapping and update the catalog entities accordingly.

## Let's Test It

This section includes a sample webhook event sent from Sentry when an issue or comment is created. In addition, it includes the entity created from the event based on the webhook configuration provided in the previous section.

### Payload

Here is an example of the payload structure sent to the webhook URL when a Sentry issue or comment is created:

<details>
<summary> Sentry issue webhook event payload</summary>

```json showLineNumbers
{
  "action": "created",
  "installation": {
    "uuid": "54a3e698-f389-4d86-b9f8-50093a228449"
  },
  "data": {
    "issue": {
      "id": "4253613038",
      "shareId": "None",
      "shortId": "PYTHON-B",
      "title": "NameError: name 'total' is not defined",
      "culprit": "__main__ in <module>",
      "permalink": "None",
      "logger": "None",
      "level": "error",
      "status": "unresolved",
      "statusDetails": {},
      "substatus": "new",
      "isPublic": false,
      "platform": "python",
      "project": {
        "id": "4504989602480128",
        "name": "python",
        "slug": "python",
        "platform": "python"
      },
      "type": "error",
      "metadata": {
        "value": "name 'total' is not defined",
        "type": "NameError",
        "filename": "sentry.py",
        "function": "<module>",
        "display_title_with_tree_label": false
      },
      "numComments": 0,
      "assignedTo": "None",
      "isBookmarked": false,
      "isSubscribed": false,
      "subscriptionDetails": "None",
      "hasSeen": false,
      "annotations": [],
      "issueType": "error",
      "issueCategory": "error",
      "isUnhandled": true,
      "count": "1",
      "userCount": 0,
      "firstSeen": "2023-06-15T17:10:09.914274Z",
      "lastSeen": "2023-06-15T17:10:09.914274Z"
    }
  },
  "actor": {
    "type": "application",
    "id": "sentry",
    "name": "Sentry"
  }
}
```

</details>

<details>
<summary> Sentry comment webhook event payload</summary>

```json showLineNumbers
{
  "action": "created",
  "installation": {
    "uuid": "d5a2de51-0138-496a-8e79-c17747c3a40d"
  },
  "data": {
    "comment_id": "1729635072",
    "issue_id": "4253613038",
    "project_slug": "python",
    "timestamp": "2023-06-15T17:15:53.383120Z",
    "comment": "Hello admin please take a look at this"
  },
  "actor": {
    "type": "user",
    "id": 2683666,
    "name": "user@domain.com"
  }
}
```

</details>

### Mapping Result

The combination of the sample payload and the webhook configuration generates the following Port `sentryIssue` entity:

```json showLineNumbers
{
  "identifier": "4253613038",
  "title": "NameError: name 'total' is not defined",
  "blueprint": "sentryIssue",
  "properties": {
    "action": "created",
    "level": "error",
    "platform": "python",
    "status": "unresolved",
    "projectID": "4504989602480128"
  },
  "relations": {}
}
```

In addition, the following Port `sentryComment` entity will be generated:

```json showLineNumbers
{
  "identifier": "1729635072",
  "title": "Comment Event",
  "blueprint": "sentryComment",
  "properties": {
    "action": "created",
    "comment": "Hello admin please take a look at this",
    "project": "python",
    "issue_id": "4253613038",
    "timestamp": "2023-06-15T17:15:53.383120Z"
  },
  "relations": {
    "sentryIssue": "4253613038"
  }
}
```
